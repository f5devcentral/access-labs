<!DOCTYPE html>
<head>
  
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PPZPQ6');</script>
  <!-- End Google Tag Manager -->
    <title>Lab 3: Utilize HTTP Connector(15.1)</title>
  

  <meta charset="utf-8">
  <!-- Twitter Bootstrap viewport setting -->
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!-- F5 metadata -->
  <meta name="title" content="Lab 3: Utilize HTTP Connector(15.1)"/>
  <meta name="product" content="F5 Identity and Access Management Solutions"/>
  <meta name="version" content=""/>
  <meta name="updated_date"  content="2021-06-21 13:45:41"/>
  <meta name="archived" content="Archived documents excluded"/>
  <meta name="doc_type" content="Manual"/>
  <meta name="lifecycle" content="release"/>
  <meta name="F5 Identity and Access Management Solutions" content=""/>


  

  
  <link href="https://cdn.f5.com/favicon.ico" rel="icon">

</head>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lab 3: Utilize HTTP Connector(15.1) &#8212; F5 Identity and Access Management Solutions  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" href="../../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/f5.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/f5-theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/CoveoFullSearch.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    <link rel="stylesheet" href="https://use.fontawesome.com/21fb8a09c3.css" type="text/css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Lab 4: Explore AccessGuard(15.1)" href="lab04.html" />
    <link rel="prev" title="Lab 2: Onboard a Second Application(15.1)" href="lab02.html" /> 
  </head><body>
  <div id="clouddocs-header"></div>

    <div id="sidebar" class="section-nav">
      
      <!--  version selector ------------------>
      <div id="version_selector_wrapper">
      </div>
      <nav class="nav-sidebartoc">

        
         <h5>F5 Identity and Access Management Solutions  </h5>
        

        <hr>
        <span class="nav-sidebartoc">
            <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../class1/class1.html">100 Series: Access Foundational Concepts</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../class2.html">200 Series: Assisted Deployment Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class3/class3.html">300 Series: Advanced Use Cases &amp; Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class4/class4.html">400 Series: Access Automation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class5/class5.html">500 Series: Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../archived/archived.html">Archived Identity &amp; Access Management Labs</a></li>
</ul>

        </span><!-- Use this file to add extra links to the bottom of the ToC sidebar -->
<hr>
  <span class="nav-sidebartoc">
 <!-- insert content here -->
  </span>
      </nav>
    </div>


    <div id="right-sidebar">
      <h7 style="font-weight:normal">On this page:</h7>
      <nav class="nav-sidebartoc">
        <span class="nav-sidebartoc">
            <ul>
<li><a class="reference internal" href="#">Lab 3: Utilize HTTP Connector(15.1)</a><ul>
<li><a class="reference internal" href="#section-3-1-create-the-http-connector-request">Section 3.1 - Create the HTTP Connector Request</a><ul>
<li><a class="reference internal" href="#task-1-create-a-dns-resolver">Task 1 - Create a DNS Resolver</a></li>
<li><a class="reference internal" href="#task-2-create-a-serverside-ssl-profile">Task 2 - Create a ServerSide SSL Profile</a></li>
<li><a class="reference internal" href="#task-3-create-a-http-connector-transport">Task 3 - Create a HTTP Connector Transport</a></li>
<li><a class="reference internal" href="#task-4-create-a-http-connector-request">Task 4 - Create a HTTP Connector Request</a></li>
</ul>
</li>
<li><a class="reference internal" href="#section-3-2-add-http-connector-to-the-iap-policy">Section 3.2 - Add HTTP Connector to the IAP Policy</a><ul>
<li><a class="reference internal" href="#task-1-add-the-http-connector-request">Task 1 - Add the HTTP Connector Request</a></li>
</ul>
</li>
<li><a class="reference internal" href="#section-3-3-testing">Section 3.3 - Testing</a><ul>
<li><a class="reference internal" href="#task-1-access-basic-acme-com">Task 1 - Access basic.acme.com</a></li>
</ul>
</li>
</ul>
</li>
</ul>

         </span>
      </nav>
    </div>





  
  <div class="main active" id="content" >
    <article class="docs-container site-article-inner">
              <!-- custom breadcrumb -->
        <h5>
            <a href="../../index.html">F5 Identity and Access Management Solutions</a>
              &gt; <a href="../class2.html">200 Series: Assisted Deployment Use Cases</a>

          <span class="right">
             <a href="../../_sources/class2/module1/lab03.rst.txt" rel="nofollow">Source</a> |
             <a href="https://github.com/f5devcentral/f5-agility-labs-iam">Edit on <i class="fa fa-github" aria-hidden="true"></i></a>
          </span>
        </h5>
        <!-- end custom breadcrumb -->
      


    <!--a title="Export PDF" id="export-pdf" class="btn btn btn-link pull-right">View PDF</a-->
    <button type="button" id="export-pdf" class="btn btn-link right">PDF</button>


    
     
         <div class="sidebar" id="version-warning" style="display: none;">
           <p class="first sidebar-title">
           <span class="icon fa fa-info-circle fa-lg"></span> Version notice:</p>
           <p class="last" id="currentVersion"></p>
          </div>


     <div role="main">
        
  <div class="section" id="lab-3-utilize-http-connector-15-1">
<h1>Lab 3: Utilize HTTP Connector(15.1)<a class="headerlink" href="#lab-3-utilize-http-connector-15-1" title="Permalink to this headline">¶</a></h1>
<p>HTTP Connector is a new feature released in BIG-IP APM 15.1 that allows HTTP requests to be initiated from a Per-Request Policy.  This could be used to send a request to an API to retrieve additional information to make an access control decision, or send information to update an external resource.</p>
<div class="section" id="section-3-1-create-the-http-connector-request">
<h2>Section 3.1 - Create the HTTP Connector Request<a class="headerlink" href="#section-3-1-create-the-http-connector-request" title="Permalink to this headline">¶</a></h2>
<p>The HTTP Connector is made up of two parts.  The first part is called the HTTP Connector Transport and it defines settings related to SSL, DNS, timeouts, and payload sizes.  The second part is the HTTP Connector Request which contains specific details such as HTTP Method, URL, message body, and how to handle the HTTP responses.</p>
<div class="section" id="task-1-create-a-dns-resolver">
<h3>Task 1 - Create a DNS Resolver<a class="headerlink" href="#task-1-create-a-dns-resolver" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Return to the BIG-IP GUI</p>
</li>
<li><p class="first">Navigate to Network &gt;&gt; DNS Resolvers &gt;&gt; DNS Resolver List. Click the  <strong>+ (Plus symbol)</strong> Symbol</p>
<p><img alt="image0" src="../../_images/image0003.png" /></p>
</li>
<li><p class="first">Enter Name <strong>internal_resolver</strong> and click <strong>Finished</strong></p>
<p><img alt="image1" src="../../_images/image0013.png" /></p>
</li>
<li><p class="first">Click <strong>internal_resolver</strong></p>
<p><img alt="image2" src="../../_images/image0023.png" /></p>
</li>
<li><p class="first">Click the <strong>Forward Zones</strong> tab</p>
<p><img alt="image3" src="../../_images/image0033.png" /></p>
</li>
<li><p class="first">Click <strong>Add</strong></p>
<p><img alt="image4" src="../../_images/image0043.png" /></p>
</li>
<li><p class="first">Enter <strong>. (a Single dot)</strong> in the <strong>Name</strong> field</p>
</li>
<li><p class="first">Add a Nameserver by entering Address <strong>10.1.20.7</strong> and click <strong>Add</strong></p>
</li>
<li><p class="first">Click <strong>Finished</strong></p>
<p><img alt="image5" src="../../_images/image0053.png" /></p>
</li>
</ol>
</div>
<div class="section" id="task-2-create-a-serverside-ssl-profile">
<h3>Task 2 - Create a ServerSide SSL Profile<a class="headerlink" href="#task-2-create-a-serverside-ssl-profile" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Navigate to Local Traffic &gt;&gt; Profiles &gt;&gt; SSL &gt;&gt; Server. Click the  <strong>+ (Plus Symbol)</strong> Symbol</p>
<p><img alt="image6" src="../../_images/image0063.png" /></p>
</li>
<li><p class="first">Enter Name <strong>adapi.f5lab.local</strong></p>
</li>
<li><p class="first">Check <strong>Custom</strong> box to the right of the Certificate and Key fields to make them editable.</p>
</li>
<li><p class="first">Select <strong>apiadmin.crt</strong> from the Certificate dropdown</p>
</li>
<li><p class="first">Select <strong>apiadmin.key</strong> from the key dropdown</p>
</li>
<li><p class="first">Click <strong>Finished</strong> at the Bottom of the page</p>
<p><img alt="image7" src="../../_images/image0073.png" /></p>
</li>
</ol>
</div>
<div class="section" id="task-3-create-a-http-connector-transport">
<h3>Task 3 - Create a HTTP Connector Transport<a class="headerlink" href="#task-3-create-a-http-connector-transport" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Navigate to Access &gt;&gt; Authentication &gt;&gt; HTTP Connector &gt;&gt; HTTP Connector Transport  Click the  <strong>+ (Plus Symbol)</strong></p>
<p><img alt="image8" src="../../_images/image0083.png" /></p>
</li>
<li><p class="first">Enter the name <strong>demo-http-connector</strong></p>
</li>
<li><p class="first">Select <strong>internal_resolver</strong> from the DNS Resolver dropdown</p>
</li>
<li><p class="first">Select <strong>adapi.f5lab.local</strong> from the Server SSL Profile</p>
</li>
<li><p class="first">Click <strong>Save</strong></p>
<p><img alt="image9" src="../../_images/image0093.png" /></p>
</li>
</ol>
</div>
<div class="section" id="task-4-create-a-http-connector-request">
<h3>Task 4 - Create a HTTP Connector Request<a class="headerlink" href="#task-4-create-a-http-connector-request" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Navigate to Access &gt;&gt; Authentication &gt;&gt; HTTP Connector &gt;&gt; HTTP Connector Request.  Click the  <strong>+ (Plus Symbol)</strong></p>
<p><img alt="image10" src="../../_images/image0103.png" /></p>
</li>
<li><p class="first">Enter name <strong>get-aduser-attributes</strong></p>
</li>
<li><p class="first">Select <strong>demo-http-connector</strong> from the dropdown</p>
</li>
<li><p class="first">Enter URL <strong>https://adapi.f5lab.local:8443/user?username=%{perflow.username}</strong></p>
</li>
<li><p class="first">Enter <strong>GET</strong> for the Method</p>
</li>
<li><p class="first">Select <strong>Parse</strong> for the Response Action</p>
</li>
<li><p class="first">Click <strong>Save</strong></p>
<p><img alt="image11" src="../../_images/0114.png" /></p>
</li>
</ol>
</div>
</div>
<div class="section" id="section-3-2-add-http-connector-to-the-iap-policy">
<h2>Section 3.2 - Add HTTP Connector to the IAP Policy<a class="headerlink" href="#section-3-2-add-http-connector-to-the-iap-policy" title="Permalink to this headline">¶</a></h2>
<p>Now that the HTTP Connector Request has been defined you will add it to basic.acme.com application and test.</p>
<div class="section" id="task-1-add-the-http-connector-request">
<h3>Task 1 - Add the HTTP Connector Request<a class="headerlink" href="#task-1-add-the-http-connector-request" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">From the web browser, click on the <strong>Access</strong> tab located on the left side.</p>
<p><a class="reference internal" href="../../_images/image0122.png"><img alt="image12" src="../../_images/image0122.png" style="width: 800px;" /></a></p>
</li>
<li><p class="first">Click <strong>Guided Configuration</strong></p>
</li>
<li><p class="first">Click <strong>IAP_DEMO</strong></p>
<p><img alt="image14" src="../../_images/image0143.png" /></p>
</li>
<li><p class="first">Click on <strong>Contextual Access</strong></p>
<p><a class="reference internal" href="../../_images/image0153.png"><img alt="image15" src="../../_images/image0153.png" style="width: 1200px;" /></a></p>
</li>
<li><p class="first">Click on <strong>basic.acme.com</strong></p>
<p><img alt="image16" src="../../_images/image0163.png" /></p>
</li>
<li><p class="first">Click <strong>Add</strong> under Trigger Rules</p>
<p><img alt="image17" src="../../_images/image0173.png" /></p>
</li>
<li><p class="first">Enter Name <strong>get-user-status</strong></p>
</li>
<li><p class="first">Check <strong>HTTP Connector Request</strong></p>
</li>
<li><p class="first">Select <strong>get-aduser-attributes</strong> from the HTTP Connector Request dropdown</p>
</li>
<li><p class="first">Under Value (Success Expression) enter <strong>expr {[mcget {subsession.http_connector.body.userAccountControl}] == 66048 }</strong></p>
</li>
<li><p class="first">Select <strong>Step Up</strong> from the Match Action dropdown</p>
</li>
<li><p class="first">Select <strong>Custom Radius based Authentication (MFA)</strong> from the Step Up Authentication field</p>
</li>
<li><p class="first">Click <strong>Save</strong></p>
<p><img alt="image18" src="../../_images/image0183.png" /></p>
</li>
<li><p class="first">Change the <strong>Match Action</strong> field for the <strong>Default Fallback</strong> rule to <strong>Reject</strong></p>
</li>
<li><p class="first">Click <strong>Save</strong></p>
<p><img alt="image19" src="../../_images/image0193.png" /></p>
</li>
<li><p class="first">Click <strong>Deploy</strong>. Deployment will take a few moments.</p>
<p><img alt="image20" src="../../_images/image0203.png" /></p>
</li>
</ol>
</div>
</div>
<div class="section" id="section-3-3-testing">
<h2>Section 3.3 - Testing<a class="headerlink" href="#section-3-3-testing" title="Permalink to this headline">¶</a></h2>
<p>In this section you will test how HTTP connector can influence policy changes dynamically as conditions change in the network .</p>
<div class="section" id="task-1-access-basic-acme-com">
<h3>Task 1 - Access basic.acme.com<a class="headerlink" href="#task-1-access-basic-acme-com" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">From the jump box open Chrome and open Developer Tools</p>
<p><img alt="image21" src="../../_images/image0213.png" /></p>
</li>
<li><p class="first">Ensure <strong>Disable Cache</strong> is checked</p>
<p><img alt="image22" src="../../_images/image0223.png" /></p>
</li>
<li><p class="first">Access the site <strong>https://basic.acme.com</strong></p>
</li>
<li><p class="first">Login with the Username: <strong>user2</strong> and Password: <strong>user2</strong></p>
<p><img alt="image23" src="../../_images/image0233.png" /></p>
</li>
<li><p class="first">Enter the PIN <strong>123456</strong> for RADIUS authentication</p>
<p><img alt="image24" src="../../_images/image0243.png" /></p>
</li>
<li><p class="first">You will be presented the website</p>
<p><img alt="image25" src="../../_images/image0253.png" /></p>
</li>
<li><p class="first">From a separate browser tab access the BIG-IP management interface <a class="reference external" href="https://bigip1.f5lab.local">https://bigip1.f5lab.local</a></p>
</li>
<li><p class="first">Navigate to Access &gt;&gt; Overview &gt;&gt; <strong>Active Sessions</strong></p>
<p><img alt="image26" src="../../_images/image0262.png" /></p>
</li>
<li><p class="first">You will see an active session for <strong>user2</strong>.</p>
</li>
<li><p class="first">Expand the session to see all the sub-sessions by clicking the <strong>+ (Plus symbol)</strong> to the left of the session ID.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Your session ID will not match the one displayed in the screenshot below.</p>
</div>
<p><img alt="image27" src="../../_images/image0272.png" /></p>
</li>
<li><p class="first">Click <strong>View</strong> to the right of the HTTP Connector request <strong>get-user-status</strong> to see the sub-session variables.</p>
<p><img alt="image28" src="../../_images/image0283.png" /></p>
</li>
<li><p class="first">You will notice that HTTP Connector received multiple values back in the response and each JSON key was parsed to individual subsession variables.</p>
</li>
<li><p class="first">userAccountControl is currently set to <strong>66048</strong>.  Which mean the account is enabled and the password never expires.</p>
<p><a class="reference internal" href="../../_images/image0293.png"><img alt="image29" src="../../_images/image0293.png" style="width: 1000px;" /></a></p>
</li>
<li><p class="first">Click <strong>Cancel</strong></p>
</li>
<li><p class="first">Expand the session to see all the sub-sessions by clicking the <strong>+ (Plus Symbol)</strong> to the left of the session ID.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You session ID will not match the one displayed in the screenshot below.</p>
</div>
<p><img alt="image27" src="../../_images/image0272.png" /></p>
</li>
<li><p class="first">If the HTTP Connector sub-session still exists check off that specific sub-session only and click <strong>Kill Selected Sessions</strong></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You are doing this to speed up the process and bypass the typical timers associated with HTTP Connector. This will enable you to see HTTP Connector trigger immediately on the next HTTP request sent from the jumphost.</p>
</div>
<p><img alt="image30" src="../../_images/image0303.png" /></p>
</li>
<li><p class="first">Locate the <strong>DisableUser2.ps1</strong> Powershell script located on the desktop.</p>
</li>
<li><p class="first">Right click the script and select <strong>Run with PowerShell</strong>.  A Powershell window will appear displaying User2 account is Disabled.</p>
<p><img alt="image32" src="../../_images/0322.png" /></p>
</li>
<li><p class="first">Return to your existing <a class="reference external" href="https://basic.acme.com">https://basic.acme.com</a> session.</p>
</li>
<li><p class="first">Click on one of the links for the website.  You will receive a <strong>Deny Page</strong>.</p>
<p><img alt="image33" src="../../_images/image0333.png" /></p>
</li>
<li><p class="first">If you return to the sub-session variables screen in BIG-IP you will see UserAccountControl was <strong>66050</strong>.</p>
<p><img alt="image34" src="../../_images/image0343.png" /></p>
</li>
<li><p class="first">This concludes lab 3.</p>
<p><img alt="image100" src="../../_images/100.png" /></p>
</li>
</ol>
</div>
</div>
</div>


     </div>
    
     <div class="row next-prev-btn-row">
       <div class="col-lg-12">
       
        <a href="lab02.html" title="Lab 2: Onboard a Second Application(15.1)" accesskey="p" class="btn btn-primary left"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous</a>
       
       
          <a href="lab04.html" title="Lab 4: Explore AccessGuard(15.1)" accesskey="n" class="btn btn-primary right">Next <i class="fa fa-arrow-circle-right" aria-hidden="true"></i></a>
       
     </div>
     </div>
    

    </article>
  </div>

</div>


  <div id="clouddocs-footer"></div>
  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->

  <script src="../../_static/js/index.js"></script>
  <script src="../../_static/js/jquery.appear.js"></script>
  <script src="../../_static/js/printThis.js"></script>
  <script src="../../_static/js/bootstrap.min.js"></script>
  <script src="../../_static/js/clouddocs.js"></script>
  <script src="../../_static/js/CoveoJsSearch.Lazy.min.js"></script>
  </body>
</html>