<!DOCTYPE html>
<head>
  
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PPZPQ6');</script>
  <!-- End Google Tag Manager -->
    <title>Lab 3: oAuth and OpenID Connect Lab (Google)</title>
  

  <meta charset="utf-8">
  <!-- Twitter Bootstrap viewport setting -->
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!-- F5 metadata -->
  <meta name="title" content="Lab 3: oAuth and OpenID Connect Lab (Google)"/>
  <meta name="product" content="F5 Identity and Access Management Solutions"/>
  <meta name="version" content=""/>
  <meta name="updated_date"  content="2021-06-21 13:23:29"/>
  <meta name="archived" content="Archived documents excluded"/>
  <meta name="doc_type" content="Manual"/>
  <meta name="lifecycle" content="release"/>
  <meta name="F5 Identity and Access Management Solutions" content=""/>


  

  
  <link href="https://cdn.f5.com/favicon.ico" rel="icon">

</head>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lab 3: oAuth and OpenID Connect Lab (Google) &#8212; F5 Identity and Access Management Solutions  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" href="../../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/f5.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/f5-theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/CoveoFullSearch.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    <link rel="stylesheet" href="https://use.fontawesome.com/21fb8a09c3.css" type="text/css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Lab 4: oAuth and AzureAD Lab" href="lab4.html" />
    <link rel="prev" title="Lab 2: IDaaS SAML Identity Provider (iDP) Lab (OKTA)" href="lab2.html" /> 
  </head><body>
  <div id="clouddocs-header"></div>

    <div id="sidebar" class="section-nav">
      
      <!--  version selector ------------------>
      <div id="version_selector_wrapper">
      </div>
      <nav class="nav-sidebartoc">

        
         <h5>F5 Identity and Access Management Solutions  </h5>
        

        <hr>
        <span class="nav-sidebartoc">
            <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../class1/class1.html">100 Series: Access Foundational Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class2/class2.html">200 Series: Assisted Deployment Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class3/class3.html">300 Series: Advanced Use Cases &amp; Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class4/class4.html">400 Series: Access Automation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class5/class5.html">500 Series: Troubleshooting</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../archived.html">Archived Identity &amp; Access Management Labs</a></li>
</ul>

        </span><!-- Use this file to add extra links to the bottom of the ToC sidebar -->
<hr>
  <span class="nav-sidebartoc">
 <!-- insert content here -->
  </span>
      </nav>
    </div>


    <div id="right-sidebar">
      <h7 style="font-weight:normal">On this page:</h7>
      <nav class="nav-sidebartoc">
        <span class="nav-sidebartoc">
            <ul>
<li><a class="reference internal" href="#">Lab 3: oAuth and OpenID Connect Lab (Google)</a><ul>
<li><a class="reference internal" href="#objective">Objective:</a></li>
<li><a class="reference internal" href="#lab-requirements">Lab Requirements:</a></li>
<li><a class="reference internal" href="#lab-3-tasks">Lab 3 Tasks:</a><ul>
<li><a class="reference internal" href="#task-1-setup-googles-api-credentials">TASK 1: Setup Google’s API Credentials</a></li>
<li><a class="reference internal" href="#task-2-setup-f5-oauth-provider">TASK 2: Setup F5 OAuth Provider</a></li>
<li><a class="reference internal" href="#task-3-setup-f5-oauth-server-client">TASK 3: Setup F5 OAuth Server (Client)</a></li>
<li><a class="reference internal" href="#task-4-setup-f5-per-session-policy-access-policy">TASK 4: Setup F5 Per Session Policy (Access Policy)</a></li>
<li><a class="reference internal" href="#task-5-associate-access-policy-to-virtual-server">TASK 5: Associate Access Policy to Virtual Server</a></li>
<li><a class="reference internal" href="#task-6-test-app-f5demo-com">TASK 6: Test app.f5demo.com</a></li>
<li><a class="reference internal" href="#task-7-per-request-policy-controls">TASK 7: Per Request Policy Controls</a></li>
<li><a class="reference internal" href="#task-8-review-oauth-results">TASK 8: Review OAuth Results</a></li>
</ul>
</li>
</ul>
</li>
</ul>

         </span>
      </nav>
    </div>





  
  <div class="main active" id="content" >
    <article class="docs-container site-article-inner">
              <!-- custom breadcrumb -->
        <h5>
            <a href="../../index.html">F5 Identity and Access Management Solutions</a>
              &gt; <a href="../archived.html">Archived Identity &amp; Access Management Labs</a>
              &gt; <a href="class6.html">Class 6: Federating Common Services</a>

          <span class="right">
             <a href="../../_sources/archived/class6/lab3.rst.txt" rel="nofollow">Source</a> |
             <a href="https://github.com/f5devcentral/f5-agility-labs-iam">Edit on <i class="fa fa-github" aria-hidden="true"></i></a>
          </span>
        </h5>
        <!-- end custom breadcrumb -->
      


    <!--a title="Export PDF" id="export-pdf" class="btn btn btn-link pull-right">View PDF</a-->
    <button type="button" id="export-pdf" class="btn btn-link right">PDF</button>


    
     
         <div class="sidebar" id="version-warning" style="display: none;">
           <p class="first sidebar-title">
           <span class="icon fa fa-info-circle fa-lg"></span> Version notice:</p>
           <p class="last" id="currentVersion"></p>
          </div>


     <div role="main">
        
  <div class="section" id="lab-3-oauth-and-openid-connect-lab-google">
<h1>Lab 3: oAuth and OpenID Connect Lab (Google)<a class="headerlink" href="#lab-3-oauth-and-openid-connect-lab-google" title="Permalink to this headline">¶</a></h1>
<p>The purpose of this lab is to better understand the F5 use cases OAuth2
and OpenID Connect by deploying a lab based on a popular 3rd party
login: Google. Google supports OpenID Connect with OAuth2 and JSON Web
Tokens. This allows a user to securely log in, or to provide a secondary
authentication factor to log in. Archive files are available for the
completed Lab 2.</p>
<div class="section" id="objective">
<h2>Objective:<a class="headerlink" href="#objective" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Gain a better understanding of the F5 use cases OAuth2 and OpenID
Connect.</li>
<li>Develop an awareness of the different deployment models that OAuth2,
OpenID Connect and JSON Web Tokens (JWT) open up</li>
</ul>
</div>
<div class="section" id="lab-requirements">
<h2>Lab Requirements:<a class="headerlink" href="#lab-requirements" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>All Lab requirements will be noted in the tasks that follow</li>
<li>Estimated completion time: 25 minutes</li>
</ul>
</div>
<div class="section" id="lab-3-tasks">
<h2>Lab 3 Tasks:<a class="headerlink" href="#lab-3-tasks" title="Permalink to this headline">¶</a></h2>
<div class="section" id="task-1-setup-googles-api-credentials">
<h3>TASK 1: Setup Google’s API Credentials<a class="headerlink" href="#task-1-setup-googles-api-credentials" title="Permalink to this headline">¶</a></h3>
<p>Refer to the instructions and screen shots below:</p>
<table border="1" class="docutils align-default">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first"><em>Note: If you do not have Google/gMail account, you will need to set one up. Navigate to:</em></p>
<ul class="last simple">
<li><a class="reference external" href="https://console.developers.google.com/apis/credentials">https://console.developers.google.com/apis/credentials</a> &amp; follow the directions for setup.*</li>
</ul>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../../_images/image621.png"><img alt="image60" src="../../_images/image621.png" style="width: 1.37500in; height: 1.42298in;" /></a>
<a class="reference internal" href="../../_images/image631.png"><img alt="image61" src="../../_images/image631.png" style="width: 1.83333in; height: 1.44662in;" /></a></td>
</tr>
</tbody>
</table>
<table border="1" class="docutils align-default">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><ol class="first last arabic">
<li><p class="first">Navigate to <a class="reference external" href="https://console.developers.google.com/apis/credentials">https://console.developers.google.com/apis/credentials</a> and log in with your</p>
<p>developer account.</p>
</li>
</ol>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../../_images/image641.png"><img alt="image62" src="../../_images/image641.png" style="width: 3.61350in; height: 0.25904in;" /></a></td>
</tr>
</tbody>
</table>
<table border="1" class="docutils align-default">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><ol class="first last arabic" start="2">
<li><p class="first">You will be redirected to the Google API’s screen. If you are previously familiar with</p>
<p>Google API’s you can create a new Project.</p>
</li>
<li><p class="first">If you have not been you will be prompted to create a New Project.</p>
</li>
<li><p class="first">Click <strong>Create</strong> in the dialogue box provided.</p>
</li>
</ol>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../../_images/image661.png"><img alt="image64" src="../../_images/image661.png" style="width: 3.45577in; height: 1.25767in;" /></a></td>
</tr>
</tbody>
</table>
<table border="1" class="docutils align-default">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><ol class="first arabic" start="5">
<li><p class="first">In the <strong>New Project</strong> window, provide a <strong>Project Name</strong>. The suggested value is:</p>
<p><strong>F5 Federation oAuth</strong></p>
</li>
</ol>
<p><em>Note: If you have exceeded your project quota you may have to delete a project or</em></p>
<p class="last"><em>create a new account</em></p>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../../_images/image671.png"><img alt="image65" src="../../_images/image671.png" style="width: 3.08125in; height: 1.94452in;" /></a></td>
</tr>
</tbody>
</table>
<table border="1" class="docutils align-default">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><ol class="first last arabic" start="6">
<li><p class="first">In the next screen, select <strong>OAuth Client ID</strong> for the <strong>Credentials</strong> type and</p>
<p>click <strong>Create Credentials</strong></p>
</li>
</ol>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../../_images/image681.png"><img alt="image66" src="../../_images/image681.png" style="width: 3.16458in; height: 1.63370in;" /></a></td>
</tr>
</tbody>
</table>
<table border="1" class="docutils align-default">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><ol class="first last arabic" start="7">
<li><p class="first">If you have not previously accepted a Consent Screen you may be prompted to do so.</p>
<p>Click <strong>Configure Consent Screen</strong>.</p>
</li>
</ol>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../../_images/image691.png"><img alt="image67" src="../../_images/image691.png" style="width: 3.18021in; height: 1.10982in;" /></a></td>
</tr>
</tbody>
</table>
<table border="1" class="docutils align-default">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><ol class="first last arabic" start="8">
<li><p class="first">On the <strong>OAuth Consent Screen</strong> tab, enter the <strong>email address</strong> of your developer</p>
<p>account (pre-populated) for the <strong>Email Address</strong>.</p>
</li>
<li><p class="first">For the <strong>Product Name Shown to Users</strong> enter <strong>app.f5demo.com</strong>.</p>
</li>
<li><p class="first">Click <strong>Save</strong>.</p>
</li>
</ol>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../../_images/image701.png"><img alt="image68" src="../../_images/image701.png" style="width: 2.88720in; height: 2.00521in;" /></a></td>
</tr>
</tbody>
</table>
<table border="1" class="docutils align-default">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><ol class="first arabic simple" start="11">
<li>In the <strong>Create OAuth Client ID*</strong> screen select or enter the following values:</li>
</ol>
<blockquote>
<div><ul class="simple">
<li><strong>Application Type:</strong> <strong>Web Application</strong></li>
<li><strong>Name</strong>: <strong>app.f5demo.com</strong></li>
<li><strong>Authorized JavaScript Engine:</strong> <strong>https://app.f5demo.com</strong></li>
<li><strong>Authorized Redirect URIs:</strong> <strong>https://app.f5demo.com/oauth/client/redirect</strong></li>
</ul>
</div></blockquote>
<ol class="last arabic simple" start="12">
<li>Click <strong>Create</strong>.</li>
</ol>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../../_images/image711.png"><img alt="image69" src="../../_images/image711.png" style="width: 3.28125in; height: 2.26534in;" /></a></td>
</tr>
</tbody>
</table>
<table border="1" class="docutils align-default">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><ol class="first arabic simple" start="13">
<li>In the <strong>OAuth Client</strong> pop-up window copy and paste your <strong>Client ID</strong> and</li>
</ol>
<blockquote class="last">
<div><strong>Client Secret</strong> in Gedit text editor provided on your desktop.</div></blockquote>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../../_images/image721.png"><img alt="image70" src="../../_images/image721.png" style="width: 3.33125in; height: 1.39217in;" /></a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="task-2-setup-f5-oauth-provider">
<h3>TASK 2: Setup F5 OAuth Provider<a class="headerlink" href="#task-2-setup-f5-oauth-provider" title="Permalink to this headline">¶</a></h3>
<p>Refer to the instructions and screen shots below:</p>
<table border="1" class="docutils align-default">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><ol class="first arabic simple">
<li>Create the <strong>OAuth Provider</strong> by navigating to <strong>Access</strong> -&gt; <strong>Federation</strong> -&gt;</li>
</ol>
<blockquote class="last">
<div><strong>OAuth Client/Resource Server</strong> -&gt; <strong>Provider</strong> and clicking <strong>Create</strong>.</div></blockquote>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../../_images/image731.png"><img alt="image71" src="../../_images/image731.png" style="width: 3.43558in; height: 1.07255in;" /></a></td>
</tr>
</tbody>
</table>
<table border="1" class="docutils align-default">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><ol class="first arabic simple" start="2">
<li>Using the following values to complete the OAuth Provider</li>
</ol>
<ul class="simple">
<li><strong>Name:</strong> <strong>Google_Provider</strong></li>
<li><strong>Type:</strong> <strong>Google</strong></li>
<li><strong>Trusted Certificate Authorities:</strong> <strong>ca-bundle.crt</strong></li>
<li><strong>Allow Self-Signed JWK Config:</strong>  <strong>checked</strong></li>
<li><strong>Use Auto-discovered JWT:</strong> <strong>checked</strong></li>
</ul>
<ol class="last arabic simple" start="3">
<li>Click <strong>Discover</strong>.</li>
<li>Accept all other defaults.</li>
<li>Click <strong>Save</strong>.</li>
</ol>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../../_images/image741.png"><img alt="image72" src="../../_images/image741.png" style="width: 3.49738in; height: 4.78430in;" /></a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="task-3-setup-f5-oauth-server-client">
<h3>TASK 3: Setup F5 OAuth Server (Client)<a class="headerlink" href="#task-3-setup-f5-oauth-server-client" title="Permalink to this headline">¶</a></h3>
<p>Refer to the instructions and screen shots below:</p>
<table border="1" class="docutils align-default">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><ol class="first last arabic">
<li><p class="first">Create the <strong>OAuth Server (Client)</strong> by navigating to <strong>Access</strong> -&gt; <strong>Federation</strong> -&gt;</p>
<p><strong>OAuth Client/Resource Server</strong> -&gt; <strong>OAuth Server</strong> and clicking <strong>Create</strong>.</p>
</li>
</ol>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../../_images/image751.png"><img alt="image73" src="../../_images/image751.png" style="width: 3.58125in; height: 0.63905in;" /></a></td>
</tr>
</tbody>
</table>
<table border="1" class="docutils align-default">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><ol class="first arabic simple" start="2">
<li>Using the following values to complete the OAuth Provider</li>
</ol>
<ul class="simple">
<li><strong>Name:</strong> <strong>Google_Server</strong></li>
<li><strong>Mode:</strong> <strong>Client</strong></li>
<li><strong>Type:</strong> <strong>Google</strong></li>
<li><strong>OAuth Provider:</strong> <strong>Google_Provider</strong></li>
<li><strong>DNS Resolver:</strong> <strong>proxy_dns_resolver</strong></li>
<li><strong>Client ID:</strong> <strong>&lt;your client id&gt;</strong></li>
<li><strong>Client Secret:</strong> <strong>&lt;your client secret&gt;</strong></li>
<li><strong>Client’s Server SSL Profile Name:</strong> <strong>serverssl</strong></li>
</ul>
<ol class="last arabic simple" start="3">
<li>Click <strong>Finished</strong>.</li>
</ol>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../../_images/image761.png"><img alt="image74" src="../../_images/image761.png" style="width: 3.38575in; height: 2.95455in;" /></a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="task-4-setup-f5-per-session-policy-access-policy">
<h3>TASK 4: Setup F5 Per Session Policy (Access Policy)<a class="headerlink" href="#task-4-setup-f5-per-session-policy-access-policy" title="Permalink to this headline">¶</a></h3>
<p>Refer to the instructions and screen shots below:</p>
<table border="1" class="docutils align-default">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><ol class="first last arabic">
<li><p class="first">Create the <strong>Per Session Policy</strong> by navigating to <strong>Access -&gt; Profile/Policies</strong> -&gt;</p>
<p><strong>Access Profiles (Per Session Policies)</strong> and clicking <strong>Create</strong>.</p>
</li>
</ol>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../../_images/image771.png"><img alt="image75" src="../../_images/image771.png" style="width: 3.59729in; height: 0.47370in;" /></a></td>
</tr>
</tbody>
</table>
<table border="1" class="docutils align-default">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><ol class="first arabic simple" start="2">
<li>In the <strong>New Profile</strong> dialogue window enter the following values</li>
</ol>
<ul class="simple">
<li><strong>Name:</strong> <strong>Google_OAuth</strong></li>
<li><strong>Profile Type:</strong> <strong>All</strong></li>
<li><strong>Profile Scope:</strong> <strong>Profile</strong></li>
<li><strong>Language:</strong> <strong>English</strong></li>
</ul>
<ol class="last arabic simple" start="3">
<li>Click <strong>Finished</strong>.</li>
</ol>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../../_images/image781.png"><img alt="image76" src="../../_images/image781.png" style="width: 3.58653in; height: 2.84049in;" /></a></td>
</tr>
</tbody>
</table>
<table border="1" class="docutils align-default">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li>Click <strong>Edit</strong> link on for the <strong>Google_OAuth</strong> Access Policy.</li>
</ol>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../../_images/image791.png"><img alt="image77" src="../../_images/image791.png" style="width: 3.55864in; height: 0.65031in;" /></a></td>
</tr>
</tbody>
</table>
<table border="1" class="docutils align-default">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><ol class="first last arabic simple" start="5">
<li>In the <strong>Google_OAuth</strong> Access Policy, click the “<strong>+</strong>” between <strong>Start</strong> &amp; <strong>Deny</strong></li>
<li>Click the <strong>Authentication</strong> tab in the events window.</li>
<li>Scroll down and click the radio button for <strong>OAuth Client</strong>.</li>
<li>Click <strong>Add Item</strong>.</li>
</ol>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../../_images/image801.png"><img alt="image78" src="../../_images/image801.png" style="width: 3.64514in; height: 1.52147in;" /></a></td>
</tr>
</tbody>
</table>
<table border="1" class="docutils align-default">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><ol class="first arabic simple" start="9">
<li>In the <strong>*OAuth_Client*</strong> window enter the following values as shown:</li>
</ol>
<ul class="simple">
<li><strong>Server:</strong> <strong>/Common/Google_Server</strong></li>
<li><strong>Grant Type:</strong> <strong>Authorization code</strong></li>
<li><strong>OpenID Connect:</strong> <strong>Enabled</strong></li>
<li><strong>OpenID Connect Flow Type:</strong> <strong>Authorization code</strong></li>
<li><strong>Authentication Redirect Request:</strong> <strong>/Common/GoogleAuthRedirectRequest</strong></li>
<li><strong>Token Request:</strong> <strong>/Common/GoogleTokenRequest</strong></li>
<li><strong>Refresh Token Request:</strong> <strong>/Common/GoogleTokenRefreshRequest</strong></li>
<li><strong>OpenID Connect UserInfo Request:</strong> <strong>/Common/GoogleUserinfoRequest</strong></li>
<li><strong>Redirection URI:</strong> <strong>https://%{session.server.network.name}/oauth/client/redirect</strong></li>
<li><strong>Scope:</strong> <strong>openid profile email</strong></li>
</ul>
<ol class="last arabic simple" start="10">
<li>Click <strong>Save</strong>.</li>
</ol>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../../_images/image811.png"><img alt="image79" src="../../_images/image811.png" style="width: 3.59509in; height: 1.58711in;" /></a></td>
</tr>
</tbody>
</table>
<table border="1" class="docutils align-default">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><ol class="first arabic simple" start="11">
<li>Click on the <strong>Deny</strong> link, in the <strong>Select Binding</strong>, select the <strong>Allow</strong> radio button</li>
</ol>
<blockquote class="last">
<div>and click <strong>Save</strong>.</div></blockquote>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../../_images/image821.png"><img alt="image80" src="../../_images/image821.png" style="width: 3.55215in; height: 1.16329in;" /></a></td>
</tr>
</tbody>
</table>
<table border="1" class="docutils align-default">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><ol class="first arabic simple" start="12">
<li>Click on the <strong>*Apply Access Policy*</strong> link in the top left-hand corner.</li>
</ol>
<p><em>Note: Additional actions can be taken in the Per Session policy (Access Policy).</em></p>
<p><em>The lab is simply completing authorization. Other access controls can be implemented based</em></p>
<p class="last"><em>on the use case</em>.</p>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../../_images/image831.png"><img alt="image81" src="../../_images/image831.png" style="width: 3.53374in; height: 1.34193in;" /></a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="task-5-associate-access-policy-to-virtual-server">
<h3>TASK 5: Associate Access Policy to Virtual Server<a class="headerlink" href="#task-5-associate-access-policy-to-virtual-server" title="Permalink to this headline">¶</a></h3>
<p>Refer to the instructions and screen shots below:</p>
<table border="1" class="docutils align-default">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><ol class="first last arabic">
<li><p class="first">Navigate to <strong>Local Traffic</strong> -&gt; <strong>Virtual Servers</strong> -&gt; <strong>Virtual Server List</strong> and click</p>
<p>on the <strong>app.f5demo.com</strong> Virtual Server link.</p>
</li>
<li><p class="first">Scroll to the <strong>Access Policy</strong> section.</p>
</li>
</ol>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../../_images/image841.png"><img alt="image82" src="../../_images/image841.png" style="width: 3.50234in; height: 2.68712in;" /></a></td>
</tr>
</tbody>
</table>
<table border="1" class="docutils align-default">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><ol class="first last arabic" start="3">
<li><p class="first">Use the <strong>Access Profile</strong> drop down to change the <strong>Access Profile</strong> to <strong>Google_OAuth</strong></p>
</li>
<li><p class="first">Use the <strong>Per-Request Policy</strong> drop down to change the <strong>Per-Request Policy</strong> to</p>
<p><strong>Google_oauth_policy</strong></p>
</li>
<li><p class="first">Scroll to the bottom of the <strong>Virtual Server</strong> configuration and click <strong>Update</strong></p>
</li>
</ol>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../../_images/image851.png"><img alt="image83" src="../../_images/image851.png" style="width: 3.49738in; height: 1.72209in;" /></a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="task-6-test-app-f5demo-com">
<h3>TASK 6: Test app.f5demo.com<a class="headerlink" href="#task-6-test-app-f5demo-com" title="Permalink to this headline">¶</a></h3>
<p>Refer to the instructions and screen shots below:</p>
<table border="1" class="docutils align-default">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><ol class="first last arabic simple">
<li>Navigate in your provided browser to <strong>https://app.f5demo.com</strong></li>
</ol>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../../_images/image861.png"><img alt="image84" src="../../_images/image861.png" style="width: 3.57570in; height: 0.25694in;" /></a></td>
</tr>
</tbody>
</table>
<table border="1" class="docutils align-default">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li>Authenticate with the account you established your Google Developer account with.</li>
</ol>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../../_images/image871.png"><img alt="image85" src="../../_images/image871.png" style="width: 3.24109in; height: 2.82822in;" /></a></td>
</tr>
</tbody>
</table>
<table border="1" class="docutils align-default">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><ol class="first last arabic simple" start="3">
<li>Did you successfully redirect to the Google?</li>
<li>After successful authentication, were you returned to the app.f5demo.com?</li>
<li>Did you successfully pass your OAuth Token?</li>
</ol>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../../_images/image881.png"><img alt="image86" src="../../_images/image881.png" style="width: 3.16168in; height: 2.42702in;" /></a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="task-7-per-request-policy-controls">
<h3>TASK 7: Per Request Policy Controls<a class="headerlink" href="#task-7-per-request-policy-controls" title="Permalink to this headline">¶</a></h3>
<p>Refer to the instructions and screen shots below:</p>
<table border="1" class="docutils align-default">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><ol class="first last arabic simple">
<li>In the application page for <strong>https://app.f5demo.com</strong> click the <strong>Admin Link</strong> shown</li>
</ol>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../../_images/image891.png"><img alt="image87" src="../../_images/image891.png" style="width: 2.86751in; height: 2.21224in;" /></a></td>
</tr>
</tbody>
</table>
<table border="1" class="docutils align-default">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><ol class="first last arabic" start="2">
<li><p class="first">You will receive an <strong>Access to this page is blocked</strong> (customizable) message with a</p>
<p>reference. You have been blocked because you do not have access on a per request basis.</p>
</li>
<li><p class="first">Press the <strong>Back</strong> button in your browser to return to <strong>https://app.f5demo.com</strong>.</p>
</li>
</ol>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../../_images/image901.png"><img alt="image88" src="../../_images/image901.png" style="width: 2.80941in; height: 1.35399in;" /></a></td>
</tr>
</tbody>
</table>
<table border="1" class="docutils align-default">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><ol class="first arabic" start="4">
<li><p class="first">Navigate to <strong>Local Traffic</strong> -&gt; <strong>iRules</strong> -&gt; <strong>Datagroup List</strong> and click on the</p>
<p><strong>Allowed_Users</strong> datagroup.</p>
</li>
<li><p class="first">Enter your <strong>Google Account</strong> used for this lab as the <strong>String</strong> value.</p>
</li>
<li><p class="first">Click <strong>Add</strong> then Click <strong>Update</strong>.</p>
</li>
</ol>
<p><em>Note: We are using a DataGroup control to minimize lab resources and steps. AD or LDAP</em></p>
<p><em>Group memberships, Session variables, other user attributes and various other access</em></p>
<p class="last"><em>control mechanisms can be used to achieve similar results.</em></p>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../../_images/image911.png"><img alt="image89" src="../../_images/image911.png" style="width: 3.15971in; height: 2.33461in;" /></a></td>
</tr>
</tbody>
</table>
<table border="1" class="docutils align-default">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><ol class="first arabic" start="7">
<li><p class="first">You should now be able to successfully to access the Admin Functions by clicking on the</p>
<p><strong>Admin Link</strong>.</p>
</li>
</ol>
<p><em>Note: Per Request Policies are dynamic and do not require the same “Apply Policy” action as</em></p>
<p class="last"><em>Per Session Policies.</em></p>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../../_images/image921.png"><img alt="image90" src="../../_images/image921.png" style="width: 3.40586in; height: 1.10658in;" /></a></td>
</tr>
</tbody>
</table>
<table border="1" class="docutils align-default">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><ol class="first arabic simple" start="8">
<li>To review the Per Request Policy, navigate to <strong>Access Profiles/Policies</strong> -&gt;</li>
</ol>
<blockquote class="last">
<div><strong>Per Request Policies</strong> and click on the <strong>Edit</strong> link for the <strong>Google_oauth_policy</strong>.</div></blockquote>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../../_images/image931.png"><img alt="image91" src="../../_images/image931.png" style="width: 3.42307in; height: 1.50171in;" /></a></td>
</tr>
</tbody>
</table>
<table border="1" class="docutils align-default">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><ol class="first arabic simple" start="9">
<li>The various Per-Request-Policy actions can be reviewed</li>
</ol>
<p class="last"><em>Note: Other actions like Step-Up Auth controls can be performed in a Per-Request Policy.</em></p>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../../_images/image941.png"><img alt="image92" src="../../_images/image941.png" style="width: 3.45192in; height: 1.33345in;" /></a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="task-8-review-oauth-results">
<h3>TASK 8: Review OAuth Results<a class="headerlink" href="#task-8-review-oauth-results" title="Permalink to this headline">¶</a></h3>
<p>Refer to the instructions and screen shots below:</p>
<table border="1" class="docutils align-default">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><ol class="first last arabic">
<li><p class="first">Review your Active Sessions (<strong>Access</strong> -&gt; <strong>Overview</strong> -&gt; <strong>Active Sessions</strong>).</p>
</li>
<li><p class="first">You can review Session activity or session variable from this window or kill the</p>
<p>selected Session.</p>
</li>
</ol>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../../_images/image951.png"><img alt="image93" src="../../_images/image951.png" style="width: 3.59450in; height: 1.52876in;" /></a></td>
</tr>
</tbody>
</table>
<table border="1" class="docutils align-default">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><ol class="first last arabic simple" start="3">
<li>Review your Access Report Logs (<strong>Access</strong> -&gt; <strong>Overview</strong> -&gt; <strong>Access Reports</strong>).</li>
</ol>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../../_images/image961.png"><img alt="image94" src="../../_images/image961.png" style="width: 2.06848in; height: 1.53438in;" /></a></td>
</tr>
</tbody>
</table>
<table border="1" class="docutils align-default">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li>In the <strong>Report Parameters window</strong> click <strong>Run Report</strong>.</li>
</ol>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../../_images/image971.png"><img alt="image95" src="../../_images/image971.png" style="width: 3.52761in; height: 0.80655in;" /></a></td>
</tr>
</tbody>
</table>
<table border="1" class="docutils align-default">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><ol class="first last arabic simple" start="5">
<li>Look at the <strong>SessionID</strong> report by clicking the <strong>Session ID</strong> Link.</li>
</ol>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../../_images/image981.png"><img alt="image96" src="../../_images/image981.png" style="width: 3.64074in; height: 1.05961in;" /></a></td>
</tr>
</tbody>
</table>
<table border="1" class="docutils align-default">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><ol class="first arabic" start="6">
<li><p class="first">Look at the <strong>Session Variables</strong> report by clicking the <strong>View Session Variables</strong> link.</p>
<p>Pay attention to the OAuth Variables.</p>
</li>
</ol>
<p><em>Note: Any of these session variables can be used to perform further actions to improve</em></p>
<p><em>security or constrain access with logic in the Per-Session or Per Request VPE policies or</em></p>
<p class="last"><em>iRules/iRulesLX.</em></p>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../../_images/image991.png"><img alt="image97" src="../../_images/image991.png" style="width: 3.62160in; height: 1.84971in;" /></a></td>
</tr>
</tbody>
</table>
<table border="1" class="docutils align-default">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><ol class="first last arabic" start="7">
<li><p class="first">Review your Access Report Logs (<strong>Access</strong> -&gt; <strong>Overview</strong> -&gt; <strong>OAuth Reports</strong> -&gt;</p>
<p><strong>Client/Resource Server</strong>).</p>
</li>
</ol>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../../_images/image1001.png"><img alt="image98" src="../../_images/image1001.png" style="width: 3.60694in; height: 2.16776in;" /></a></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>


     </div>
    
     <div class="row next-prev-btn-row">
       <div class="col-lg-12">
       
        <a href="lab2.html" title="Lab 2: IDaaS SAML Identity Provider (iDP) Lab (OKTA)" accesskey="p" class="btn btn-primary left"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous</a>
       
       
          <a href="lab4.html" title="Lab 4: oAuth and AzureAD Lab" accesskey="n" class="btn btn-primary right">Next <i class="fa fa-arrow-circle-right" aria-hidden="true"></i></a>
       
     </div>
     </div>
    

    </article>
  </div>

</div>


  <div id="clouddocs-footer"></div>
  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->

  <script src="../../_static/js/index.js"></script>
  <script src="../../_static/js/jquery.appear.js"></script>
  <script src="../../_static/js/printThis.js"></script>
  <script src="../../_static/js/bootstrap.min.js"></script>
  <script src="../../_static/js/clouddocs.js"></script>
  <script src="../../_static/js/CoveoJsSearch.Lazy.min.js"></script>
  </body>
</html>