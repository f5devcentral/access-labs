<!DOCTYPE html>
<head>
  
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PPZPQ6');</script>
  <!-- End Google Tag Manager -->
    <title>Lab 1: APM GUI Overview</title>
  

  <meta charset="utf-8">
  <!-- Twitter Bootstrap viewport setting -->
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!-- F5 metadata -->
  <meta name="title" content="Lab 1: APM GUI Overview"/>
  <meta name="product" content="F5 Identity and Access Management Solutions"/>
  <meta name="version" content=""/>
  <meta name="updated_date"  content="2021-06-21 14:22:47"/>
  <meta name="archived" content="Archived documents excluded"/>
  <meta name="doc_type" content="Manual"/>
  <meta name="lifecycle" content="release"/>
  <meta name="F5 Identity and Access Management Solutions" content=""/>


  

  
  <link href="https://cdn.f5.com/favicon.ico" rel="icon">

</head>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lab 1: APM GUI Overview &#8212; F5 Identity and Access Management Solutions  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" href="../../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/f5.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/f5-theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/CoveoFullSearch.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    <link rel="stylesheet" href="https://use.fontawesome.com/21fb8a09c3.css" type="text/css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Lab 2: Visual Policy Editor (VPE) Overview" href="lab02.html" />
    <link rel="prev" title="Environment Overview" href="intro.html" /> 
  </head><body>
  <div id="clouddocs-header"></div>

    <div id="sidebar" class="section-nav">
      
      <!--  version selector ------------------>
      <div id="version_selector_wrapper">
      </div>
      <nav class="nav-sidebartoc">

        
         <h5>F5 Identity and Access Management Solutions  </h5>
        

        <hr>
        <span class="nav-sidebartoc">
            <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../class1.html">100 Series: Access Foundational Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class2/class2.html">200 Series: Assisted Deployment Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class3/class3.html">300 Series: Advanced Use Cases &amp; Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class4/class4.html">400 Series: Access Automation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class5/class5.html">500 Series: Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../archived/archived.html">Archived Identity &amp; Access Management Labs</a></li>
</ul>

        </span><!-- Use this file to add extra links to the bottom of the ToC sidebar -->
<hr>
  <span class="nav-sidebartoc">
 <!-- insert content here -->
  </span>
      </nav>
    </div>


    <div id="right-sidebar">
      <h7 style="font-weight:normal">On this page:</h7>
      <nav class="nav-sidebartoc">
        <span class="nav-sidebartoc">
            <ul>
<li><a class="reference internal" href="#">Lab 1: APM GUI Overview</a><ul>
<li><a class="reference internal" href="#objectives">Objectives</a></li>
<li><a class="reference internal" href="#setup-lab-environment">Setup Lab Environment</a></li>
<li><a class="reference internal" href="#task-1-resource-provisioning">Task 1: Resource Provisioning</a></li>
<li><a class="reference internal" href="#task-2-guided-configuration">Task 2: Guided Configuration</a></li>
<li><a class="reference internal" href="#task-3-overview">Task 3: Overview</a></li>
<li><a class="reference internal" href="#task-4-profile-policies">Task 4: Profile/Policies</a></li>
<li><a class="reference internal" href="#task-5-authentication">Task 5: Authentication</a></li>
<li><a class="reference internal" href="#task-6-single-sign-on">Task 6: Single Sign-On</a></li>
<li><a class="reference internal" href="#task-7-federation">Task 7: Federation</a></li>
<li><a class="reference internal" href="#task-8-connectivity-vpn">Task 8: Connectivity/VPN</a></li>
<li><a class="reference internal" href="#task-8-lab-cleanup">Task 8: Lab Cleanup</a></li>
</ul>
</li>
</ul>

         </span>
      </nav>
    </div>





  
  <div class="main active" id="content" >
    <article class="docs-container site-article-inner">
              <!-- custom breadcrumb -->
        <h5>
            <a href="../../index.html">F5 Identity and Access Management Solutions</a>
              &gt; <a href="../class1.html">100 Series: Access Foundational Concepts</a>

          <span class="right">
             <a href="../../_sources/class1/module1/lab01.rst.txt" rel="nofollow">Source</a> |
             <a href="https://github.com/f5devcentral/f5-agility-labs-iam">Edit on <i class="fa fa-github" aria-hidden="true"></i></a>
          </span>
        </h5>
        <!-- end custom breadcrumb -->
      


    <!--a title="Export PDF" id="export-pdf" class="btn btn btn-link pull-right">View PDF</a-->
    <button type="button" id="export-pdf" class="btn btn-link right">PDF</button>


    
     
         <div class="sidebar" id="version-warning" style="display: none;">
           <p class="first sidebar-title">
           <span class="icon fa fa-info-circle fa-lg"></span> Version notice:</p>
           <p class="last" id="currentVersion"></p>
          </div>


     <div role="main">
        
  <div class="section" id="lab-1-apm-gui-overview">
<h1>Lab 1: APM GUI Overview<a class="headerlink" href="#lab-1-apm-gui-overview" title="Permalink to this headline">¶</a></h1>
<div class="section" id="objectives">
<h2>Objectives<a class="headerlink" href="#objectives" title="Permalink to this headline">¶</a></h2>
<p>The intention of this lab will be to show how to enable Access Policy Manager (APM) through resource provisioning.  Next we will explore all the components within the <strong>Access</strong> left menu.
This is not a deep dive on the components but an overview of the components, features and concepts of APM.</p>
</div>
<div class="section" id="setup-lab-environment">
<h2>Setup Lab Environment<a class="headerlink" href="#setup-lab-environment" title="Permalink to this headline">¶</a></h2>
<p>To access your dedicated student lab environment, you will need a web browser and Remote Desktop Protocol (RDP) client software. The web browser will be used to access the Unified Demo Framework (UDF) Training Portal. The RDP client will be used to connect to the jumphost, where you will be able to access the BIG-IP management interfaces (HTTPS, SSH).</p>
<ol class="arabic">
<li><p class="first">Click <strong>DEPLOYMENT</strong> located on the top left corner to display the environment</p>
</li>
<li><p class="first">Click <strong>ACCESS</strong> next to jumphost.f5lab.local</p>
<p><img alt="accessjh" src="../../_images/accessjh.png" /></p>
</li>
<li><p class="first">Select your RDP resolution.</p>
</li>
<li><p class="first">The RDP client on your local host establishes a RDP connection to the Jump Host.</p>
</li>
<li><p class="first">Login with the following credentials:</p>
<blockquote>
<div><ul class="simple">
<li>User: <strong>f5lab\user1</strong></li>
<li>Password: <strong>user1</strong></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">After successful logon the Chrome browser will auto launch opening the site <a class="reference external" href="https://portal.f5lab.local">https://portal.f5lab.local</a>.  This process usually takes 30 seconds after logon.</p>
</li>
<li><p class="first">Click the <strong>Classes</strong> tab at the top of the page.</p>
<blockquote>
<div><p><img alt="accessportal" src="../../_images/accessportal.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Scroll down the page until you see <strong>101 Intro to Access Foundational Concepts</strong> on the left</p>
<p><img alt="101intro" src="../../_images/101intro.png" /></p>
</li>
<li><p class="first">Hover over tile <strong>APM GUI Overview</strong>. A start and stop icon should appear within the tile.  Click the <strong>Play</strong> Button to start the automation to build the environment</p>
<table border="1" class="docutils align-default">
<colgroup>
<col width="54%" />
<col width="46%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><img alt="guioverview" src="../../_images/guioverview.png" /></td>
<td><img alt="guiflyout" src="../../_images/guiflyout.png" /></td>
</tr>
</tbody>
</table>
</li>
<li><p class="first">After the click it may take up to 30 seconds before you see processing</p>
<p><img alt="process" src="../../_images/process.png" /></p>
</li>
<li><p class="first">Scroll to the bottom of the automation workflow to ensure all requests succeeded.  If you experience errors try running the automation a second time or open an issue on the <a class="reference external" href="https://github.com/f5devcentral/access-labs">Access Labs Repo</a>.</p>
<p><img alt="issues" src="../../_images/issues.png" /></p>
</li>
</ol>
</div>
<div class="section" id="task-1-resource-provisioning">
<h2>Task 1: Resource Provisioning<a class="headerlink" href="#task-1-resource-provisioning" title="Permalink to this headline">¶</a></h2>
<p>Access Policy Manager (APM) is a module available for use on the BIG-IP platform (Hardware and Virtual).  Unlike other modules, APM can be provisioned with limited functionality on any BIG-IP platform without a specific license (<a class="reference external" href="https://support.f5.com/csp/article/K15854">see F5 KB15854</a>).  APM is licensed based on the number of Access Sessions and Concurrent Users Sessions (<a class="reference external" href="https://support.f5.com/csp/article/K72971039">see APM Operations Guide</a>). You can provision APM limited and immediately start using all the functions of APM with a limitation of 10 Access and Concurrent user session.</p>
<blockquote>
<div><div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">APM has already been provisioned for this lab.  The next step would be completed if you are provisioning on your own BIG-IP.</p>
</div>
</div></blockquote>
<ol class="arabic">
<li><p class="first">Log in to bigip1.f5lab.local with administrative credentials provided</p>
</li>
<li><p class="first">On the left menu navigate to <strong>System</strong> –&gt; <strong>Resource Provisioning</strong></p>
</li>
<li><p class="first">Click box and on the drop down next to the module and choose <strong>Nominal</strong></p>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In most use cases you will want to use <strong>Nominal</strong> for provisioning modules.  What does each setting mean?</p>
</div>
<table border="1" class="docutils align-default">
<colgroup>
<col width="15%" />
<col width="85%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Dedicated</td>
<td>Specifies that all resources are dedicated to the module you are provisioning. For all
other modules, the level option must be set to none.</td>
</tr>
<tr class="row-even"><td>Minimum</td>
<td>Specifies that you want to provision the minimum amount of  resources for the module
you are provisioning.</td>
</tr>
<tr class="row-odd"><td>Nominal</td>
<td>Specifies that you want to share all of the available resources equally among all of
the modules that are licensed on the unit.</td>
</tr>
</tbody>
</table>
<p><img alt="image01" src="../../_images/image01.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Before you click on Submit note that this operation will halt operations while the module provisions.  Do not do this on an active unit processing traffic unless you are in an outage window. This will not require a reboot but will take approximately 1 to 5 minutes to complete.</p>
<blockquote>
<div><p><img alt="image02" src="../../_images/image02.png" />
<img alt="image03" src="../../_images/image03.png" /></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Resource Provisioning is not a synced item between HA pairs.  You will need to provision the module on all devices in the cluster.</p>
</div>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="task-2-guided-configuration">
<h2>Task 2: Guided Configuration<a class="headerlink" href="#task-2-guided-configuration" title="Permalink to this headline">¶</a></h2>
<p>Access Guided Configuration (AGC) provides an easy way to create BIG-IP configurations for categories of Access use cases. This feature is an independent release from TMOS and requires updates for new configurations from time to time. To find updates and expanded use cases it will be necessary to download and install updates from <a class="reference external" href="https://downloads.f5.com">https://downloads.f5.com</a>. In this task we are going to explore the menu and take a look at a few options. We will not be deploying any of these solutions in this lab.</p>
<ol class="arabic">
<li><p class="first">Go to <strong>Access</strong> –&gt; <strong>Guided Configuration</strong></p>
</li>
<li><p class="first">A set of tiles appears at top listing the areas of use cases where Guided Configuration can be used</p>
<blockquote>
<div><p><img alt="image06" src="../../_images/image615.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Click on the Federation Tile.</p>
</li>
<li><p class="first">Under this tile are several Identity Federation use cases available.  Each use case has an accompanying guide to walk you through the configuration.  This is not designed for already deployed applications but used for new deployments.  All the components needed to create the configuration will be deployed on the BIG-IP through this guide.  Editing and configuring of the solution will be maintained within this menu.</p>
</li>
<li><p class="first">Click on <strong>SAML Service Provider</strong></p>
</li>
<li><p class="first">Here you will find there are couple topologies.  SAML SP Initiated and SAML IdP Initiated.</p>
<blockquote>
<div><table border="1" class="docutils align-default">
<colgroup>
<col width="52%" />
<col width="48%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><img alt="image08" src="../../_images/image814.png" /></td>
<td><img alt="image09" src="../../_images/image914.png" /></td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
<li><p class="first">If there are any required configuration pieces missing to complete guided configuration they will appear in the right pane</p>
<blockquote>
<div><p><img alt="image07" src="../../_images/image715.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Below the topologies you will find all the components that will be configured using the guided configured</p>
<blockquote>
<div><p><img alt="image10" src="../../_images/image1014.png" /></p>
</div></blockquote>
</li>
<li><p class="first">From here you would click next to begin configuration. (We will explore this further in the 300 Series labs)</p>
</li>
<li><p class="first">Click on the Guide Configuration bread crumb at the top of the screen to return to the main menu.</p>
</li>
<li><p class="first">Click on the Zero Trust tile.</p>
</li>
<li><p class="first">Zero trust follows the principle never trust, always verify and thus enforces authentication and verification for every user or device attempting to access resources whether from within or outside of the network.</p>
<blockquote>
<div><p><strong>About Identity Aware proxy</strong></p>
<p>The easiest way to create policies to support zero trust security is to use the Zero Trust-Identity Aware Proxy template in Access Guided Configuration. The template takes you through the
steps needed to create an Identity Aware Proxy. Access Policy Manager (APM) acts as the Identity Aware Proxy helping to simplify client access to both multi-cloud and on-premise web applications,
and securely manage access from client devices.</p>
<p>On APM, you can develop per-request policies with subroutines that perform different levels of authentication, federated identity management, SSO (single sign on), and MFA (multi-factor
authentication) depending on the requirements. Subroutines perform continuous checking based on a specified duration or gating criteria. Policies can be as complex or as simple as you need
them to be to provide seamless yet secure access to resources. Refer to Implementing Zero Trust with Per-Request Policies for many examples of per-request policies that implement different
aspects of zero trust.</p>
<p>For additional security, device posture checking provides instantaneous device posture information. The system can continuously check clients to be sure, for example, that their antivirus,
firewall, and patches meet company requirements, ensuring that the device maintains trust at all times.</p>
<p>On the client side, F5 Access Guard allows real-time posture information to be inspected with per-request policy subroutines. F5 Access Guard generates posture information asynchronously,
and transparently transmits it to chosen APM server endpoints using special HTTP headers. Refer to BIG-IP Access Policy Manager: Configuring F5 Access Guard
for details on client requirements.</p>
</div></blockquote>
</li>
<li><p class="first">Click on the <strong>Identity Aware Proxy</strong> configuration option</p>
</li>
<li><p class="first">There are two topologies available:</p>
<blockquote>
<div><table border="1" class="docutils align-default">
<colgroup>
<col width="37%" />
<col width="32%" />
<col width="32%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Single Proxy</td>
<td><img alt="image13" src="../../_images/image1314.png" /></td>
<td><img alt="image17" src="../../_images/image1713.png" /></td>
</tr>
<tr class="row-even"><td>Multi-Proxy</td>
<td><img alt="image019" src="../../_images/0191.png" /></td>
<td><img alt="image16" src="../../_images/image1613.png" /></td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
<li><p class="first">Proceeding with this configuration will create a number of object as seen here.</p>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you are interested in learning more on this specific solution please consider taking the Zero Trust Identity Aware Proxy class.</p>
</div>
<p><img alt="image18" src="../../_images/image1812.png" /></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Webtop is available as of version 16.0</p>
</div>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="task-3-overview">
<h2>Task 3: Overview<a class="headerlink" href="#task-3-overview" title="Permalink to this headline">¶</a></h2>
<p>The Overview menu is where an administrator can view active sessions, previous sessions, and view various reports.</p>
<ol class="arabic">
<li><p class="first">Click on <strong>Access</strong> –&gt; <strong>Overview</strong> from the left menu</p>
</li>
<li><p class="first">Here is where we would see Active Sessions.  When users login to applications using APM policies the sessions will appear in this pane.</p>
<blockquote>
<div><p><img alt="activesessions" src="../../_images/activesessions.png" /></p>
</div></blockquote>
</li>
<li><p class="first">This is also where you will be able to kill sessions.  For more on logging see Lab 3</p>
<blockquote>
<div><p><img alt="killsession" src="../../_images/killsession.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Click on <strong>Access</strong> –&gt; <strong>Overview</strong> –&gt; <strong>Access Report</strong></p>
</li>
<li><p class="first">This section will give you details on the all sessions active and inactive.  Each log item is a message on the policy flow as a user walks through an Access policy.  (We will cover Per Session and Per Request policies in in more detail later).</p>
</li>
<li><p class="first">You will be prompted to enter a time period to run the report</p>
<blockquote>
<div><p><img alt="image22" src="../../_images/image223.png" /></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is how you can view past sessions.  Pick a time frame and run a report.</p>
</div>
</div></blockquote>
</li>
<li><p class="first">There are two other reporting functions in this screen, <strong>OAuth Report</strong> and <strong>SWG Reports</strong>.  We will not cover these reports in this lab.</p>
</li>
<li><p class="first">The last section is Event Logs.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">URL Request Logs is part of SWG functionality and will not be covered in this lab</p>
</div>
</li>
<li><p class="first">From the top menu bar Click on the drop down next to <strong>Event Logs</strong> and choose <strong>Settings</strong>. This is where you can create logging profiles for access policies.  From here you can specify what information to collect and to what detail.</p>
</li>
<li><p class="first">Click the <strong>Create</strong> button</p>
</li>
<li><p class="first">We will create a new APM Log profile</p>
<blockquote>
<div><table border="1" class="docutils align-default">
<colgroup>
<col width="27%" />
<col width="33%" />
<col width="41%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>General Information</td>
<td>Name</td>
<td>basic_log_profile</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>Enable Access System Logs</td>
<td>Check box</td>
</tr>
<tr class="row-odd"><td>Access System Logs</td>
<td>Publisher</td>
<td>/Common/sys-db-access-publisher</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>Access Policy</td>
<td>Notice</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>ACL</td>
<td>Notice</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>Secure Web Gateway</td>
<td>Notice</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>OAuth</td>
<td>Notice</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>VDI</td>
<td>Notice</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>ADFS Proxy</td>
<td>Notice</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>Per-Request Policy</td>
<td>Notice</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>SSO</td>
<td>Notice</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>ECA</td>
<td>Notice</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>PingAccess Profile</td>
<td>Notice</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>Endpoint Management System</td>
<td>Notice</td>
</tr>
<tr class="row-odd"><td>Access Profile</td>
<td>Selected</td>
<td>(leave this blank for now)</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Within the Access System Logs section of the log profile is where you can change the logging for various portions of the APM Policies.  The one you will use most will be to move Access Policy from Notice to Debug and/or Pre-Request Policy from Notice to Debug.  As you can see you can pick and choose what level of notifications you want in your logs.  This will impact what you see in Access Reports for a session and what appears in /var/log/apm.</p>
</div>
</div></blockquote>
</li>
<li><p class="first">Click OK</p>
</li>
<li><p class="first">From the left menu go to <strong>Access</strong> –&gt; <strong>Overview</strong> –&gt; <strong>Dashboard</strong></p>
<blockquote>
<div><p><img alt="image23" src="../../_images/image233.png" /></p>
</div></blockquote>
</li>
<li><p class="first">The Dashboard can give you a quick synopsis on Access Session, Network Access Session, Portal Access and Access control Lists.</p>
<blockquote>
<div><p><img alt="Dashboard" src="../../_images/Dashboard.png" /></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For more reporting on APM stats look to BIG-IQ or exporting logs to 3rd party SIEMs and create your own dashboard.</p>
</div>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="task-4-profile-policies">
<h2>Task 4: Profile/Policies<a class="headerlink" href="#task-4-profile-policies" title="Permalink to this headline">¶</a></h2>
<p>Profiles and Policies are where we begin to learn about what makes APM function.  In order for APM functions to be added to a Virtual server we need to create Access Profiles and Policies.  These entities take all the components we will look at below and put them in a logical flow through the Visual Policy Editor (VPE). These entities are things like login pages, authentication, single sign on methods and endpoint checks.  To being we have to create an Access Profile.  Within that profile we create a per session policy.  When that is completed we attach that profile to a Virtual Server.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can associate one Access Profile (which includes a per-session policy) and one per-request policy per virtual server.</p>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">We will creating objects for use within this task.</p>
</div>
<ol class="arabic">
<li><p class="first">From the left menu go to <strong>Access</strong> –&gt; <strong>Profiles/Policies</strong> –&gt; <strong>Access Profiles (Per-Session Policies)</strong></p>
<blockquote>
<div><p>The per-session policy runs when a client initiates a session. (A per-session policy is also known as an access policy.) Depending on the actions you include in the access policy, it can authenticate the user and perform other actions that populate session variables with data for use throughout the session.</p>
</div></blockquote>
</li>
<li><p class="first">Click on the Create button on the far right</p>
<blockquote>
<div><table border="1" class="docutils align-default">
<colgroup>
<col width="27%" />
<col width="33%" />
<col width="41%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>General Properties</td>
<td>Name</td>
<td>server1-psp</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>Profile Type</td>
<td>All</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>Profile Scope</td>
<td>Profile</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>Customization Type</td>
<td>Modern</td>
</tr>
<tr class="row-odd"><td>Language Settings</td>
<td>Accepted Languages</td>
<td>English</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Customization Type is a newer setting that changes the look and feel of login pages.  For the traditional look you can <strong>Standard</strong></p>
</div>
</div></blockquote>
</li>
<li><p class="first">Click <strong>Finished</strong></p>
</li>
<li><p class="first">Now we have a basic profile.  There were a number of other settings to modify and use in the profile.  For now we will focus just on the basics.</p>
</li>
<li><p class="first">From the <strong>Access Profiles (Per-Session Policies)</strong> section locate the <strong>server1-psp</strong></p>
</li>
<li><p class="first">There are two ways to edit the Policy piece of the profile.</p>
<p>First way</p>
<table border="1" class="docutils align-default">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Click on the profile</td>
</tr>
<tr class="row-even"><td>Click on <strong>Access Policy</strong> from the top menu bar</td>
</tr>
<tr class="row-odd"><td>Click on the link to <strong>Edit Access Policy for Profile “server1-psp”</strong></td>
</tr>
<tr class="row-even"><td>This will take you to the Visual Policy Editor (VPE)</td>
</tr>
</tbody>
</table>
<p>Second way</p>
<table border="1" class="docutils align-default">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Locate the <strong>server1-psp</strong> in the Profile list and follow the line to the right.</td>
</tr>
<tr class="row-even"><td>Middle of the line there will be an <strong>Edit</strong> link</td>
</tr>
<tr class="row-odd"><td>Click the <strong>Edit</strong> link</td>
</tr>
</tbody>
</table>
</li>
<li><p class="first">Close the VPE (we will visit the VPE and policy in more detail later)</p>
</li>
<li><p class="first">Return to <strong>Access</strong> –&gt; <strong>Profiles/Policies</strong> –&gt; <strong>Access Profiles (Per-Session Policies)</strong></p>
</li>
<li><p class="first">Click on the <strong>server1-psp</strong> and explore the settings for the Profile.</p>
<table border="1" class="docutils align-default">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Settings</td>
<td>Here you can manage settings for the profile. You may want to change timeouts, max
sessions and login attempts. These are settings specifically for this profile.</td>
</tr>
<tr class="row-even"><td>Configurations</td>
<td>These are more advanced options and covered in other labs</td>
</tr>
<tr class="row-odd"><td>Language Settings</td>
<td>You have to set this at creation.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you are unsure of the settings you need at profile creation you can see that you can return to the profile and make adjustments.</p>
</div>
</li>
<li><p class="first">Still in the profile click on <strong>SSO/Auth Domain</strong> at the top</p>
<blockquote>
<div><p>BIG-IP APM offers a number of Single Sign On (SSO) options.  The SSO/Auth Domain tab in a Per Session Profile is where you will select what SSO method to use for your application. In Task 6 we will cover the objects that need to be created in order to associate that SSO method to a policy.  At this time the drop down for the SSO Configuration will have a pre-built SSO object we will use later.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We will not discuss Multi-Domain in this lab but you can find more information in the Appendix</p>
</div>
</div></blockquote>
</li>
<li><p class="first">From the top menu bar click on <strong>Logs</strong></p>
</li>
<li><p class="first">The log profile we created earlier is now listed here.  The Default log profile is attached but we can remove that and add the <strong>basic_log_profile</strong></p>
</li>
<li><p class="first">Click Update.</p>
<p>That concludes the review of the Per Session policy.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A per session profile is required (even if it is blank) to be deployed with a per request policy</p>
</div>
</li>
</ol>
<p><strong>Per Request policies</strong></p>
<ol class="arabic">
<li><p class="first">From the left menu navigate to <strong>Access</strong> –&gt; <strong>Profiles/Policies</strong> –&gt; <strong>Per Request Policies</strong></p>
<blockquote>
<div><p>APM executes per-session policies when a client attempts to connect to the enterprise. After a session starts, a per-request policy runs each time the client makes an HTTP or HTTPS request. Because of this behavior, a per-request policy is particularly useful in the context of a Secure Web Gateway or Zero Trust scenario, where the client requires re-verification on every request, or changes based on gating criteria.</p>
<p>A per-request policy can include a subroutine, which starts a subsession. Multiple subsessions can exist at one time. You can use nearly all of the same agents in per-request policies that you can use in per-session policies. However, most of the agents (including authentication agents) have to be used in a subroutine in per-request policies.</p>
</div></blockquote>
</li>
<li><p class="first">Click <strong>Create</strong></p>
<blockquote>
<div><table border="1" class="docutils align-default">
<colgroup>
<col width="27%" />
<col width="33%" />
<col width="41%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>General Properties</td>
<td>Name</td>
<td>server1_prp_policy</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>Profile Type</td>
<td>All</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>Incomplete Action</td>
<td>Deny</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>Customization Type</td>
<td>Modern</td>
</tr>
<tr class="row-odd"><td>Language Settings</td>
<td>Accepted Languages</td>
<td>English</td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
<li><p class="first">Click <strong>Finished</strong></p>
</li>
<li><p class="first">Click <strong>Edit</strong></p>
<blockquote>
<div><p>A per request policy creation will work the same way as a per session policy allowing you to add various items to the main policy and create macros. In addition a per request policy can also contain subroutines.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A per-request policy subroutine is a collection of actions. What distinguishes a subroutine from other collections of actions (such as macros), is that a subroutine starts a subsession that, for its duration, controls user access to specified resources. If a subroutine has an established subsession, subroutine execution is skipped. A subroutine is therefore useful for cases that require user interaction (such as a confirmation dialog or a step-up authentication), since it allows skipping that interaction in a subsequent access.</p>
</div>
<p>You cannot use subroutines in macros within per-request policies.
Subroutine properties specify subsession timeout values, maximum macro loop count, and gating criteria. You can reauthenticate, check for changes on the client, or take other actions based on timeouts or gating criteria.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A subsession starts when a subroutine runs and continues until reaching the maximum lifetime specified in the subroutine properties, or until the session terminates. A subsession populates subsession variables that are available for the duration of the subsession. Subsession variables and events that occur during a subsession are logged. Multiple subsessions can exist at the same time. The maximum number of subsessions allowed varies across platforms. The total number of subsessions is limited by the session limits in APM (128 * max sessions). Creating a subsession does not count against the license limit.</p>
</div>
</div></blockquote>
</li>
<li><p class="first">If you click on the plus between Start and Allow a new box will appear and you can explore the various components that can be added.  At this time we will leave the policy blank and return to populate it in later tasks.</p>
</li>
<li><p class="first">Close the VPE tab when you are done exploring.</p>
</li>
</ol>
<p><strong>Policy Sync</strong></p>
<ol class="arabic">
<li><p class="first">Click on <strong>Access</strong> –&gt; <strong>Profiles/Policies</strong> –&gt; <strong>Policy sync</strong></p>
<blockquote>
<div><p>BIG-IP APM Policy Sync maintains access policies on multiple BIG-IP APM devices while adjusting appropriate settings for objects that are specific to device locations, such as network addresses. You can synchronize policies from one BIG-IP APM device to another BIG-IP APM device, or to multiple devices in a device group.</p>
<p>A sync-only device group configured for automatic and full sync is required to synchronize access policies between multiple devices.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">USE WITH CAUTION.  This is an advanced feature and you should consult with your F5 Account team or Professional Services before implementing this configuration.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In BIG-IP 13.1.0, a maximum of eight BIG-IP APM systems are supported in a sync-only group type.</p>
</div>
</div></blockquote>
</li>
</ol>
<p><strong>Customization</strong></p>
<ol class="arabic">
<li><p class="first">Click on <strong>Access</strong> –&gt; <strong>Profiles/Policies</strong> –&gt; <strong>Customization</strong></p>
<blockquote>
<div><p><strong>What are customization and localization?</strong></p>
<p>Customization and localization are ways to change the text and the language that users see, and to change the appearance of the user interface that Access Policy Manager presents to client users. Customization provides numerous settings that let you adapt the interface to your particular operation. Localization allows you to use different languages in different countries.</p>
<p><strong>About the Customization tool</strong></p>
<p>The Customization tool is part of Access Policy Manager (APM). With the Customization tool, you can personalize screen messages and prompts, change screen layouts, colors, and images, and customize error messages and other messages using specific languages and text for policies and profiles developed in APM. You can customize settings in the Basic Customization view (fewer settings) or change the view to General Customization (many settings). In the General Customization view, you can use the Customization tool in the BIG-IP admin console, or click Popout to open it in a separate browser window. In either view, you can click Preview to see what an object (such as Logon page or Deny Ending Page) will look like.</p>
<p>After you personalize settings, remember to click the <strong>Save</strong> icon to apply your changes.</p>
</div></blockquote>
</li>
<li><p class="first">About basic, general, and advanced customization</p>
<blockquote>
<div><p>The Customization tool provides three views that you can use to customize the interface. The General Customization view provides the greatest number of options
and is where most of the customization takes place.</p>
<table border="1" class="docutils align-default">
<colgroup>
<col width="16%" />
<col width="84%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">View</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Quick Start/Basic
Customization</td>
<td>Basic customization provides a limited set of options intended for quick modification of the objects that are
commonly displayed to users. This is the default customization view. Use this to configure basic look and feel
for pages, and common text labels and captions for resources on the webtop. Different options exist depending on
the Customization Type selected when the policy was created.</td>
</tr>
<tr class="row-odd"><td>General
Customization</td>
<td><p class="first">This view provides a tree structure containing all the configuration elements, and more detailed options to
customize objects, such as:</p>
<ul class="simple">
<li>The size, color, and placement of forms and screens.</li>
<li>The look and feel of objects with more opportunities to replace images.</li>
<li>Text on the screen, including headers and footers.</li>
<li>Messages, including installation and error messages.</li>
</ul>
<p class="last">Any text or image that you can customize using the visual policy editor, can also be adjusted using the general
customization UI. Different options exist depending on the Customization Type selected when the policy was created,
and which elements were added to the access or per-request policy.</p>
</td>
</tr>
<tr class="row-even"><td>Advanced
Customization</td>
<td>Advanced customization provides direct access to PHP, Cascading Style Sheets (CSS), JavaScript, and HTML files that
you can edit to control the display and function of web and client pages in Access Policy Manager.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">See the <a class="reference external" href="https://techdocs.f5.com/en-us/bigip-16-0-0/big-ip-access-policy-manager-customization.html">APM Customization guide</a> for further details on customization</p>
</div>
</div></blockquote>
</li>
<li><p class="first">Under <strong>Available Profiles</strong> choose the <strong>/Common/server1-psp</strong></p>
</li>
<li><p class="first">Select Language:  <strong>English</strong></p>
</li>
<li><p class="first">Let’s upload a new image.  Click <strong>Upload New Image</strong></p>
</li>
<li><p class="first">Browse to <strong>Desktop</strong> and locate the <strong>Lab01_images</strong> folder</p>
</li>
<li><p class="first">Choose an image from the selection and click <strong>Open</strong></p>
</li>
<li><p class="first">Pick a Background color</p>
</li>
<li><p class="first">Pick a Header Background color</p>
</li>
<li><p class="first">Change the footer Text</p>
</li>
<li><p class="first">Remember to click <strong>Save</strong> icon at the bottom</p>
<blockquote>
<div><p><img alt="image014" src="../../_images/0141.png" /></p>
<p>..Note:: If you click the Preview button at the bottom of this screen you will get to preview the page you are editing.  However, we are going to use the Preview button located at the top right of this GUI.</p>
</div></blockquote>
</li>
<li><p class="first">Click on the <strong>Preview</strong> button (At the top right)</p>
<blockquote>
<div><p><img alt="image015" src="../../_images/0151.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Choose <strong>Access Profiles</strong> –&gt; <strong>/Common/server1-psp</strong> –&gt; <strong>Access Policy</strong> –&gt; <strong>Ending pages</strong> – <strong>Deny</strong></p>
<blockquote>
<div><p>Bonus Answer:  Why don’t we see logon pages?</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">What is in the policy so far?</p>
</div>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="task-5-authentication">
<h2>Task 5: Authentication<a class="headerlink" href="#task-5-authentication" title="Permalink to this headline">¶</a></h2>
<p>BIG-IP APM serves as an authentication gateway or proxy. As an authentication proxy, BIG-IP APM provides separate client-side and server-side authentication. Client-side authentication occurs between the client and BIG-IP APM. Server-side authentication occurs between BIG-IP APM and servers.</p>
<p>Loose coupling between the client-side and server-side layers allows for a rich set of identity transformation services. Combined with a Visual Policy Editor and an expansive set of access iRules functionality, BIG-IP APM provides flexible and dynamic identity and access, based on a variety of contexts and conditions.</p>
<p>For example, a client accessing Microsoft SharePoint through BIG-IP APM in a corporate environment may silently authenticate to BIG-IP APM with NT LAN Manager (NTLM) or Kerberos credentials. On leaving that environment, or on using a different non-sanctioned device, the client may be required to go through another potentially stronger authentication, such as a smart card or other client certificate, RSA SecurID, or one-time passcode. You can require additional device vetting such as file, folder, and registry checks and antivirus and firewall software validation.</p>
<p>A BIG-IP APM authentication and SSO features access and identity security posture can automatically change depending on environmental factors, such as who or where the user is, what resource the user is accessing, or when or with what method the user is attempting to gain access.</p>
<p>Data centers and Cloud deployments often face the challenge of offering multiple applications with different authentication requirements. You can deploy BIG-IP APM to consolidate and enforce all client-side authentication into a single process. BIG-IP APM can also perform identity transformation on the server side to authenticate to server services using the best-supported methods. This can reduce operational costs since applications remain in the most-supported and documented configurations. Common examples of identity transformation are client-side public key infrastructure (PKI) certificate to server-side Kerberos and client-side HTTP form to server-side HTTP Basic.</p>
<p>The following figure shows BIG-IP APM acting as an authentication gateway. Information received during pre-authentication is transformed to authenticate to multiple enterprise applications with different requirements.</p>
<p><img alt="image25" src="../../_images/image253.png" /></p>
<ol class="arabic">
<li><p class="first">Client-side authentication</p>
<blockquote>
<div><p>Client-side authentication involves the client (typically a user employing a browser) accessing a BIG-IP APM virtual server and presenting identity. This is called authentication, authorization, and accounting (AAA).</p>
<p>BIG-IP APM supports industry standard authentication methods, including:</p>
<ul class="simple">
<li>NTLM</li>
<li>Kerberos</li>
<li>Security Assertion Markup Language (SAML)</li>
<li>Client certificate</li>
<li>RSA SecurID</li>
<li>One-time passcode</li>
<li>HTTP Basic</li>
<li>HTTP Form</li>
<li>OAuth 2.0</li>
<li>OpenId Connect</li>
</ul>
<p>After access credentials are submitted, BIG-IP APM validates the listed methods with industry-standard mechanisms, including:</p>
<ul class="simple">
<li>Active Directory authentication and query</li>
<li>LDAP and LDAPS authentication and query</li>
<li>Remote Authentication Dial-in User Service (RADIUS)</li>
<li>Terminal Access Controller Access Control System (TACACS)</li>
<li>Online Certificate Status Protocol (OCSP) and Certificate Revocation List Distribution Point (CRLDP) (for client certificates)</li>
<li>Local User Database authentication</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Go to <strong>Access</strong> –&gt; <strong>Authentication</strong> –&gt; <strong>Active Directory</strong></p>
</li>
<li><p class="first">Click on basic-ad-servers and review the settings.  You can choose to use go direct or use a pool of AD servers.</p>
<blockquote>
<div><table border="1" class="docutils align-default">
<colgroup>
<col width="26%" />
<col width="34%" />
<col width="40%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>General Properties</td>
<td>Name</td>
<td>basic-ad-servers</td>
</tr>
<tr class="row-even"><td>Configuration</td>
<td>Domain Name</td>
<td>f5lab.local</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>Server Connection</td>
<td>Use Pool</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>Domain Controller Pool Name</td>
<td>/Common/basic-ad-pool</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>IP Address</td>
<td>10.1.20.7</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>Hostname</td>
<td>dc1.f5lab.local</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>Admin Name</td>
<td>admin</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>Admin Password</td>
<td>admin</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you choose to use a pool you can create the pool as you create the AD object.  You can also choose to use Direct which allows you to only use one server. Go back and click create to see what this looks like.</p>
</div>
<p><img alt="adpool" src="../../_images/adpool.png" /></p>
<p>You now have an object that can be used to facilitate Active Directory authentication in front of any application.  The application itself does not need to require authentication. If you were to deploy a policy with AD Auth on a Virtual Server for a web application the policy would preset a login page, prompt for credentials, verify the credentials against this AD object before allowing a user to access the web application.</p>
</div></blockquote>
</li>
<li><p class="first">Go to <strong>Access</strong> –&gt; <strong>Profiles/Policies</strong> –&gt; <strong>Access Profiles (Per-Session Policies)</strong></p>
</li>
<li><p class="first">Locate the <strong>server1-psp</strong> and click <strong>Edit</strong></p>
</li>
<li><p class="first">Click the <strong>+</strong> symbol between Start and Deny.</p>
</li>
<li><p class="first">From the <strong>Logon</strong> tab select the <strong>Logon Page</strong> radio button</p>
</li>
<li><p class="first">Click <strong>Add Item</strong></p>
</li>
<li><p class="first">Notice that you can add fields and change the names of the fields.  Click <strong>Save</strong></p>
</li>
<li><p class="first">Click the <strong>+</strong> between <strong>Logon Page</strong> and Deny</p>
</li>
<li><p class="first">Click the <strong>Authentication</strong> tab</p>
</li>
<li><p class="first">Choose the <strong>AD Auth</strong> radio button and click <strong>Add Item</strong></p>
</li>
<li><p class="first">Under the <strong>Server</strong> field click on the drop down menu and choose the AAA server <strong>basic-ad-servers</strong></p>
</li>
<li><p class="first">Click <strong>Save</strong></p>
</li>
<li><p class="first">On the Success branch click on the <strong>Deny</strong> end point and choose <strong>Allow</strong> then click <strong>Save</strong></p>
</li>
<li><p class="first">Click <strong>Apply Access Policy</strong></p>
<blockquote>
<div><p><img alt="basicpolicy" src="../../_images/basicpolicy.png" /></p>
<p>Now you have a basic policy with AD Authentication that you can leverage for Web Pre-Authorization in front of any application.</p>
</div></blockquote>
</li>
<li><p class="first">Go to <strong>Local Traffic</strong> –&gt; <strong>Virtual Servers</strong></p>
</li>
<li><p class="first">Locate <strong>server1-https</strong> and click on it</p>
</li>
<li><p class="first">Scroll down to the <strong>Access Policy</strong> section.  Next to <strong>Access Profile</strong> click the drop and chose server1-psp</p>
</li>
<li><p class="first">Scroll down to the bottom and click <strong>Update</strong></p>
</li>
<li><p class="first">In a new browser tab go to <a class="reference external" href="http://server1.acme.com">http://server1.acme.com</a> and Login</p>
<blockquote>
<div><table border="1" class="docutils align-default">
<colgroup>
<col width="52%" />
<col width="48%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>username</td>
<td>user1</td>
</tr>
<tr class="row-even"><td>password</td>
<td>user1</td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="task-6-single-sign-on">
<h2>Task 6: Single Sign-On<a class="headerlink" href="#task-6-single-sign-on" title="Permalink to this headline">¶</a></h2>
<p>..Note:: All the objects used to demonstrate Server-side Single Sign-On have already been created.  The next steps will walk you through what the configuration looks like.</p>
<p>Client side and server side are loosely coupled in the authentication proxy. Because of this, BIG-IP APM can transform client-side identity values of one type into server-side identity values of another type. You configure SSO within an SSO profile, which is applied to an access profile. The system triggers SSO at the end of successful access policy evaluation and on subsequent client-side requests.</p>
<p>BIG-IP APM supports industry standard authentication methods, including:</p>
<blockquote>
<div><ul class="simple">
<li>NTLM</li>
<li>Kerberos</li>
<li>HTTP Basic</li>
<li>HTTP Form</li>
<li>Security Assertion Markup Language (SAML)</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Client-side authentication methods outnumber server-side methods. This is because BIG-IP APM does not transmit client certificate, RSA SecurID, or one-time passcodes to the server on the client’s behalf.</p>
</div>
</div></blockquote>
<ol class="arabic">
<li><p class="first">Go to <strong>Access</strong> –&gt; <strong>Single Sign-On</strong> –&gt; <strong>HTTP Basic</strong></p>
</li>
<li><p class="first">Click <strong>basic-sso</strong></p>
<blockquote>
<div><table border="1" class="docutils align-default">
<colgroup>
<col width="26%" />
<col width="34%" />
<col width="40%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>General Properties</td>
<td>Name</td>
<td>basic-sso</td>
</tr>
<tr class="row-even"><td>Credential Source</td>
<td>Username Source</td>
<td>session.sso.token.last.username</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>Password Source</td>
<td>session.sso.token.last.password</td>
</tr>
<tr class="row-even"><td>SSO Method Conversion</td>
<td>Username Conversion</td>
<td>unchecked</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Username conversion can be enabled if you want domain\username or <a class="reference external" href="mailto:username&#37;&#52;&#48;domain">username<span>&#64;</span>domain</a> to convert to just username.</p>
</div>
</div></blockquote>
</li>
<li><p class="first">Click on <strong>Access</strong> –&gt; <strong>Profiles/Policies</strong> –&gt; <strong>Access Profiles (Per-Session Policies)</strong></p>
</li>
<li><p class="first">Locate the <strong>basic-psp</strong> profile and click on the name</p>
</li>
<li><p class="first">Click on <strong>SSO/Auth Domains</strong></p>
</li>
<li><p class="first">Under SSO Configuration notice <strong>basic_sso</strong> is selected</p>
</li>
<li><p class="first">From the top menu bar click <strong>Access Policy</strong> and click <strong>Edit Access Policy for Profile “basic-psp”</strong> link</p>
<blockquote>
<div><p><img alt="basicpsp" src="../../_images/basicpsp.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Click on <strong>SSO Credential Mapping</strong></p>
<blockquote>
<div><p><img alt="ssocredmap" src="../../_images/ssocredmap.png" /></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can modify these options based on the variables collected in the user’s session.  In this case we accept the defaults.</p>
</div>
</div></blockquote>
</li>
<li><p class="first">Open an incognito window and try go to <a class="reference external" href="https://basic.acme.com">https://basic.acme.com</a></p>
</li>
<li><p class="first">You should have been prompted with a windows login.  Close the Window</p>
</li>
<li><p class="first">Go to <strong>Local Traffic</strong> –&gt; <strong>Virtual Servers</strong> and open <strong>basic-https</strong></p>
</li>
<li><p class="first">Scroll to <strong>Access Policy</strong> and click the drop down next to <strong>Access Profile</strong>.  Choose <strong>basic-psp</strong></p>
<blockquote>
<div><p><img alt="policyattach" src="../../_images/policyattach.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Scroll down click <strong>Update</strong></p>
</li>
<li><p class="first">Open a new incognito tab.  Go to <a class="reference external" href="https://basic.acme.com">https://basic.acme.com</a></p>
</li>
<li><p class="first">Login <strong>user1</strong> and <strong>user1</strong></p>
</li>
<li><p class="first">Now you should have been signed in to the backend server with Single Sign On.</p>
</li>
</ol>
</div>
<div class="section" id="task-7-federation">
<h2>Task 7: Federation<a class="headerlink" href="#task-7-federation" title="Permalink to this headline">¶</a></h2>
<p>..Note:: In this task we will examine SAML IDP and SP configuration.  All the configuration has been completed the next several steps you will just be examining the objects and testing the configuraiton.  For more in depth instruction on Federatoion consider taking a 300 series course.</p>
<p><strong>BIG-IP APM federation with SAML</strong></p>
<blockquote>
<div>BIG-IP APM supports SAML 2.0 and can act as the IdP for popular SPs, such as Microsoft Office 365 and Salesforce. The system supports both IdP- and SP-initiated identity federation deployments.</div></blockquote>
<p><strong>IdP-initiated federation with BIG-IP APM</strong></p>
<blockquote>
<div><p><img alt="samlidp" src="../../_images/samlidp.png" /></p>
<ul class="simple">
<li>The user logs in to the BIG-IP APM IdP and the system directs them to the BIG-IP APM webtop.</li>
<li>The user selects the SP they want, such as Salesforce.</li>
<li>The system retrieves any required attributes from the user data store to pass on to the SP.</li>
<li>The system uses the browser to direct the request to the SP, along with the SAML assertion and any required attributes.</li>
</ul>
</div></blockquote>
<ol class="arabic">
<li><p class="first">In a new tab go to <a class="reference external" href="https://idp.acme.com">https://idp.acme.com</a></p>
</li>
<li><p class="first">Login to the SAML IdP</p>
<blockquote>
<div><table border="1" class="docutils align-default">
<colgroup>
<col width="52%" />
<col width="48%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Username:</td>
<td>user1</td>
</tr>
<tr class="row-even"><td>Password:</td>
<td>user1</td>
</tr>
</tbody>
</table>
<p><img alt="samlidplogin" src="../../_images/samlidplogin.png" /></p>
</div></blockquote>
</li>
<li><p class="first">You are logged in to a webtop where a SAML SP object resides.  Click on the SAML Resource sp.acme.com</p>
<blockquote>
<div><p><img alt="webtopsaml" src="../../_images/webtopsaml.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Since you authenticated through the SAML IdP you will not be prompted for authentication again and are connected to the SAML SP resource.</p>
<blockquote>
<div><p><img alt="spacme" src="../../_images/spacme.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Return to bigip1.f5lab.local.  From the left menu click <strong>Access</strong> –&gt; <strong>Profiles/Policies</strong> –&gt; <strong>Access Profiles (Per-Session Policies)</strong></p>
</li>
<li><p class="first">Locate the policy <strong>idp-psp</strong> and click on <strong>Edit</strong></p>
<blockquote>
<div><p><img alt="idppsp" src="../../_images/idppsp.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Click <em>AD Auth*</em> object within the Policy.  Examine the settings</p>
<blockquote>
<div><p><img alt="idpadauth" src="../../_images/idpadauth.png" /></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you look at the AAA server under Active directory you will find the idp-ad-server object.  We are leveraging Active Directory as the credential verification but BIG-IP is acting as a SAML Identity Provider.  BIG-IP will verify the credentials against Active Directory and create a SAML Assertion for the user requesting access.  That assertion can then be used by the SAML Service Provider to provide access to the SAML SP resource.</p>
</div>
<p><img alt="samlidpaaa" src="../../_images/samlidpaaa.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Click <strong>Advanced Resource Assign</strong>. Examine the settings</p>
<blockquote>
<div><p><img alt="samladvres" src="../../_images/samladvres.png" /></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can click on the Add/Delete button and add other SAML Resources (if available).  We will cover more on Webtop in the Access 102 lab.</p>
</div>
</div></blockquote>
</li>
<li><p class="first">Return to the BIG-IP click on <strong>Access</strong> –&gt; <strong>Federation</strong> –&gt; <strong>SAML Identity Provider</strong></p>
<blockquote>
<div><p><img alt="samlidpobj" src="../../_images/samlidpobj.png" />
<img alt="samlbindexp" src="../../_images/samlbindexp.png" /></p>
<p>In order for the BIG-IP to be configured as a SAML IdP you must define the Identity provider and bind it with a SAML Service Provider.  This object contains the settings required to configure BIG-IP as a SAML SP.  For more information on SAML and uses with BIG-IP consider taking the Federation lab.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can export the Metadata of the SAML IdP in this menu by clicking the SAML IdP and clicking the Export Metadata button.  It will output an XML file that you can use to upload in to a SAML Service Provider with all the IdP setting particular to this IdP.</p>
</div>
</div></blockquote>
</li>
</ol>
<p><strong>SP-initiated federation with BIG-IP APM</strong></p>
<blockquote>
<div><p><img alt="samlsp" src="../../_images/samlsp.png" /></p>
<ul class="simple">
<li>The user logs in to the SP, such as Salesforce.</li>
<li>The SP uses the browser to redirect the user back to the BIG-IP APM IdP.</li>
<li>The BIG-IP APM IdP prompts the user to log in.</li>
<li>The system retrieves any required attributes from the user data store to pass on to the SP.</li>
<li>The system uses the browser to send the SAML assertion and any required attributes to the SP.</li>
</ul>
</div></blockquote>
<ol class="arabic">
<li><p class="first">Open a new incognito window and go to <a class="reference external" href="https://sp.acme.com">https://sp.acme.com</a></p>
</li>
<li><p class="first">Notice that you get redirected to <a class="reference external" href="https://idp.acme.com">https://idp.acme.com</a> for authentication</p>
<blockquote>
<div><p><img alt="spinitiated" src="../../_images/spinitiated.png" /></p>
<table border="1" class="docutils align-default">
<colgroup>
<col width="52%" />
<col width="48%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Username:</td>
<td>user1</td>
</tr>
<tr class="row-even"><td>Password:</td>
<td>user1</td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
<li><p class="first">Once logged in you arrive at <a class="reference external" href="https://sp.acme.com">https://sp.acme.com</a></p>
<blockquote>
<div><p><img alt="spacme" src="../../_images/spacme.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Return to the BIG-IP.  From the left menu navigate to <strong>Access</strong> –&gt; <strong>Profiles/Policies</strong> –&gt; <strong>Access Profiles (Per-Session Policies)</strong></p>
</li>
<li><p class="first">Locate the sp-psp profile and cick <strong>Edit</strong></p>
<blockquote>
<div><p><img alt="sppsp" src="../../_images/sppsp.png" /></p>
<p>SAML Auth</p>
<p><img alt="samlspauth" src="../../_images/samlspauth.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Return to the BIG-IP and navigate to <strong>Access</strong> –&gt; <strong>Federation</strong> –&gt; <strong>SAML Service Provider</strong></p>
<blockquote>
<div><p><img alt="samlspobj" src="../../_images/samlspobj.png" /></p>
<p>The SAML SP object contains information about the SAML SP object and the binding to the SAML Identity Provider.  You can see on the screen that we have a Service Provider object defined and it is bound to a SAML Identity Provider.  The configuration of these objects is covered in more detail in the Access Federation labs.</p>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="task-8-connectivity-vpn">
<h2>Task 8: Connectivity/VPN<a class="headerlink" href="#task-8-connectivity-vpn" title="Permalink to this headline">¶</a></h2>
<p>..Note:: In interest of time the VPN configuration has already been completed.  The next several steps will be observing what the configuration looks like and testing out the connectivity.</p>
<p><strong>Policy Walk-Through</strong></p>
<ol class="arabic">
<li><p class="first">Navigate to <strong>Access</strong> –&gt; <strong>Profiles/Policies</strong> –&gt; <strong>Access Profiles (Per-Session Policies)</strong></p>
</li>
<li><p class="first">Locate profile <strong>vpn-psp</strong> and click on <strong>Edit</strong>.  This opens the Visual Policy Editor (VPE) and we can take a look at the policy</p>
<blockquote>
<div><p><img alt="image001" src="../../_images/0011.png" /></p>
</div></blockquote>
</li>
<li><p class="first">A user enters their credentials into the logon page agent.
- Those credentials are collected, stored as the default system session variables of session.logon.last.username and session.logon.last.password.</p>
</li>
<li><p class="first">The AD Auth Agent validates the username and password session variables against the configured AD Domain Controller.</p>
</li>
<li><p class="first">The user is assigned resources defined in the Advanced Resource Assign Agent</p>
</li>
<li><p class="first">The user is granted access via the Allow Terminal</p>
</li>
<li><p class="first">If unsuccessful, the user proceeds down the fallback branch and denied access via the Deny Terminal</p>
</li>
</ol>
<p><strong>Policy Agent Configuration</strong></p>
<p>The Logon Page contains only the default setting</p>
<blockquote>
<div><img alt="image002" src="../../_images/0021.png" /></div></blockquote>
<p>The AD Auth agent defines the AAA AD Servers that a user will be authenticated against.  All Setting are the default.</p>
<blockquote>
<div><img alt="image003" src="../../_images/0031.png" /></div></blockquote>
<p>The Advanced Resource Assign agent grants a user access to the assigned resources.</p>
<blockquote>
<div><img alt="image004" src="../../_images/0041.png" /></div></blockquote>
<p><strong>Supporting APM Objects</strong></p>
<p><strong>Network Access Resource</strong></p>
<ol class="arabic">
<li><p class="first">Navigate to <strong>Access</strong> –&gt; <strong>Connectivity/VPN</strong> –&gt; <strong>Network Access (VPN)</strong> –&gt; <strong>Network Access Lists</strong></p>
</li>
<li><p class="first">Click the <strong>vpn</strong> Network Access Profile</p>
<blockquote>
<div><p>The Properties page contains the Caption name <strong>VPN</strong>.  This is the name displayed to a user.</p>
<blockquote>
<div><p><img alt="image005" src="../../_images/0051.png" /></p>
</div></blockquote>
<ul>
<li><p class="first">The Network Settings tab assigns the <strong>lease pool</strong> of ip addresses that will be used for the VPN.</p>
</li>
<li><p class="first">Split Tunneling is configured to permit only the <strong>10.1.20.0/24</strong> subnet range inside the VPN.</p>
<blockquote>
<div><p><img alt="image006" src="../../_images/0061.png" /></p>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ol>
<p><strong>Lease Pool</strong></p>
<ol class="arabic">
<li><p class="first">Navigate to <strong>Access</strong> –&gt; <strong>Connectivity/VPN</strong> –&gt; <strong>Network Access (VPN)</strong> –&gt; <strong>IPV4 Lease Pools</strong></p>
</li>
<li><p class="first">Click <strong>vpn-vpn_pool</strong> lease pool object</p>
<blockquote>
<div><p>A single address of <strong>10.1.20.254</strong> is assigned inside the lease pool.</p>
<blockquote>
<div><p><img alt="image007" src="../../_images/0071.png" /></p>
</div></blockquote>
</div></blockquote>
</li>
</ol>
<p><strong>Webtop Sections</strong></p>
<ol class="arabic">
<li><p class="first">Navigate to <strong>Access</strong> –&gt; <strong>Webtops</strong> –&gt; <strong>Webtop Sections</strong></p>
</li>
<li><p class="first">Click on <strong>vpn-network_access</strong></p>
<blockquote>
<div><p>A single section is configured to display a custom name.</p>
<p><img alt="image008" src="../../_images/0081.png" /></p>
</div></blockquote>
</li>
</ol>
<p><strong>Webtop Lists</strong></p>
<ol class="arabic">
<li><p class="first">Navigate to <strong>Access</strong> –&gt; <strong>Webtops</strong> –&gt; <strong>Webtop Lists</strong></p>
</li>
<li><p class="first">Click on <strong>vpn-webtop</strong></p>
<blockquote>
<div><ul class="simple">
<li>A Full Webtop was defined with modified default settings.</li>
<li>The Minimize to Tray box is <strong>checked</strong> to ensure the Webtop is not displayed when a user connects to the VPN.</li>
</ul>
<p><img alt="image009" src="../../_images/0091.png" /></p>
</div></blockquote>
</li>
</ol>
<p><strong>The Policy from a user’s perspective</strong></p>
<ol class="arabic">
<li><p class="first">The connects to <a class="reference external" href="https://vpn.acme.com">https://vpn.acme.com</a> with the following credentials</p>
<blockquote>
<div><table border="1" class="docutils align-default">
<colgroup>
<col width="52%" />
<col width="48%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Username:</td>
<td>user1</td>
</tr>
<tr class="row-even"><td>Password:</td>
<td>user1</td>
</tr>
</tbody>
</table>
<p><img alt="image010" src="../../_images/0101.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Once authenticated the user is presented a Webtop with a single VPN icon.</p>
<blockquote>
<div><p><img alt="image011" src="../../_images/0111.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Assuming the VPN has already been installed the user is notified that the client is attempting to start</p>
<blockquote>
<div><p><img alt="image012" src="../../_images/0121.png" /></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You may be prompted to download the VPN update.  This is what a user will experience if you have auto-update enabled in the VPN Connectivity Profile. Click Download and wait for the components to update.</p>
</div>
</div></blockquote>
</li>
<li><p class="first">A popup opens displaying the status of the VPN connection.  The status will eventually become <strong>Connected</strong></p>
<blockquote>
<div><p><img alt="image013" src="../../_images/0131.png" /></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you lose the pop-up check the system tray for the little red ball.  Right click and choose <strong>restore</strong></p>
</div>
</div></blockquote>
</li>
<li><p class="first">Click <strong>Disconnect</strong></p>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For more information on API Protection consider taking the API Protection lab.  For more information on SWG, ACL and Webtops see the appendix or further APM labs.</p>
</div>
</div>
<div class="section" id="task-8-lab-cleanup">
<h2>Task 8: Lab Cleanup<a class="headerlink" href="#task-8-lab-cleanup" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">Open a new tab and click on the Access: PORTAL bookmark then select <strong>CLASSES</strong></p>
</li>
<li><p class="first">Locate the <strong>APM GUI Overview</strong> Tile and click on the <strong>Stop</strong> button</p>
<blockquote>
<div><table border="1" class="docutils align-default">
<colgroup>
<col width="54%" />
<col width="46%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><img alt="guioverview" src="../../_images/guioverview.png" /></td>
<td><img alt="guistop" src="../../_images/guistop.png" /></td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
<li><p class="first">Wait about 30 seconds for the processing to begin</p>
<blockquote>
<div><p><img alt="process" src="../../_images/process.png" /></p>
</div></blockquote>
</li>
<li><p class="first">This process will take up to 30 seconds.  Scroll to the bottom of the script and verify no issues.</p>
</li>
</ol>
<p>Lab 1 is now complete.</p>
</div>
</div>


     </div>
    
     <div class="row next-prev-btn-row">
       <div class="col-lg-12">
       
        <a href="intro.html" title="Environment Overview" accesskey="p" class="btn btn-primary left"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous</a>
       
       
          <a href="lab02.html" title="Lab 2: Visual Policy Editor (VPE) Overview" accesskey="n" class="btn btn-primary right">Next <i class="fa fa-arrow-circle-right" aria-hidden="true"></i></a>
       
     </div>
     </div>
    

    </article>
  </div>

</div>


  <div id="clouddocs-footer"></div>
  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->

  <script src="../../_static/js/index.js"></script>
  <script src="../../_static/js/jquery.appear.js"></script>
  <script src="../../_static/js/printThis.js"></script>
  <script src="../../_static/js/bootstrap.min.js"></script>
  <script src="../../_static/js/clouddocs.js"></script>
  <script src="../../_static/js/CoveoJsSearch.Lazy.min.js"></script>
  </body>
</html>