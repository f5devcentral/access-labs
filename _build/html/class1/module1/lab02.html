<!DOCTYPE html>
<head>
  
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PPZPQ6');</script>
  <!-- End Google Tag Manager -->
    <title>Lab 2: Visual Policy Editor (VPE) Overview</title>
  

  <meta charset="utf-8">
  <!-- Twitter Bootstrap viewport setting -->
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!-- F5 metadata -->
  <meta name="title" content="Lab 2: Visual Policy Editor (VPE) Overview"/>
  <meta name="product" content="F5 Identity and Access Management Solutions"/>
  <meta name="version" content=""/>
  <meta name="updated_date"  content="2021-06-21 13:23:29"/>
  <meta name="archived" content="Archived documents excluded"/>
  <meta name="doc_type" content="Manual"/>
  <meta name="lifecycle" content="release"/>
  <meta name="F5 Identity and Access Management Solutions" content=""/>


  

  
  <link href="https://cdn.f5.com/favicon.ico" rel="icon">

</head>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lab 2: Visual Policy Editor (VPE) Overview &#8212; F5 Identity and Access Management Solutions  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" href="../../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/f5.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/f5-theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/CoveoFullSearch.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    <link rel="stylesheet" href="https://use.fontawesome.com/21fb8a09c3.css" type="text/css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Lab 3: Access Logs Overview" href="lab03.html" />
    <link rel="prev" title="Lab 1: APM GUI Overview" href="lab01.html" /> 
  </head><body>
  <div id="clouddocs-header"></div>

    <div id="sidebar" class="section-nav">
      
      <!--  version selector ------------------>
      <div id="version_selector_wrapper">
      </div>
      <nav class="nav-sidebartoc">

        
         <h5>F5 Identity and Access Management Solutions  </h5>
        

        <hr>
        <span class="nav-sidebartoc">
            <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../class1.html">100 Series: Access Foundational Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class2/class2.html">200 Series: Assisted Deployment Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class3/class3.html">300 Series: Advanced Use Cases &amp; Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class4/class4.html">400 Series: Access Automation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class5/class5.html">500 Series: Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../archived/archived.html">Archived Identity &amp; Access Management Labs</a></li>
</ul>

        </span><!-- Use this file to add extra links to the bottom of the ToC sidebar -->
<hr>
  <span class="nav-sidebartoc">
 <!-- insert content here -->
  </span>
      </nav>
    </div>


    <div id="right-sidebar">
      <h7 style="font-weight:normal">On this page:</h7>
      <nav class="nav-sidebartoc">
        <span class="nav-sidebartoc">
            <ul>
<li><a class="reference internal" href="#">Lab 2: Visual Policy Editor (VPE) Overview</a><ul>
<li><a class="reference internal" href="#setup-lab-environment">Setup Lab Environment</a></li>
<li><a class="reference internal" href="#section-1-the-access-profile">Section 1 - The Access Profile</a></li>
<li><a class="reference internal" href="#section-2-visual-policy-editor-vpe">Section 2 - Visual Policy Editor(VPE)</a><ul>
<li><a class="reference internal" href="#task-2-1-branches">Task 2.1 - Branches</a></li>
<li><a class="reference internal" href="#task-2-2-building-blocks">Task 2.2 - Building Blocks</a></li>
<li><a class="reference internal" href="#task-2-3-macros">Task 2.3 - Macros</a></li>
<li><a class="reference internal" href="#task-2-5-endings">Task 2.5: Endings</a></li>
<li><a class="reference internal" href="#task-2-6-testing">Task 2.6 Testing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#lab-cleanup">Lab Cleanup</a></li>
</ul>
</li>
</ul>

         </span>
      </nav>
    </div>





  
  <div class="main active" id="content" >
    <article class="docs-container site-article-inner">
              <!-- custom breadcrumb -->
        <h5>
            <a href="../../index.html">F5 Identity and Access Management Solutions</a>
              &gt; <a href="../class1.html">100 Series: Access Foundational Concepts</a>

          <span class="right">
             <a href="../../_sources/class1/module1/lab02.rst.txt" rel="nofollow">Source</a> |
             <a href="https://github.com/f5devcentral/f5-agility-labs-iam">Edit on <i class="fa fa-github" aria-hidden="true"></i></a>
          </span>
        </h5>
        <!-- end custom breadcrumb -->
      


    <!--a title="Export PDF" id="export-pdf" class="btn btn btn-link pull-right">View PDF</a-->
    <button type="button" id="export-pdf" class="btn btn-link right">PDF</button>


    
     
         <div class="sidebar" id="version-warning" style="display: none;">
           <p class="first sidebar-title">
           <span class="icon fa fa-info-circle fa-lg"></span> Version notice:</p>
           <p class="last" id="currentVersion"></p>
          </div>


     <div role="main">
        
  <div class="section" id="lab-2-visual-policy-editor-vpe-overview">
<h1>Lab 2: Visual Policy Editor (VPE) Overview<a class="headerlink" href="#lab-2-visual-policy-editor-vpe-overview" title="Permalink to this headline">¶</a></h1>
<div class="section" id="setup-lab-environment">
<h2>Setup Lab Environment<a class="headerlink" href="#setup-lab-environment" title="Permalink to this headline">¶</a></h2>
<p>To access your dedicated student lab environment, you will require a web browser and Remote Desktop Protocol (RDP) client software. The web browser will be used to access the Lab Training Portal. The RDP client will be used to connect to the Jump Host, where you will be able to access the BIG-IP management interfaces (HTTPS, SSH).</p>
<ol class="arabic">
<li><p class="first">Click <strong>DEPLOYMENT</strong> located on the top left corner to display the environment</p>
</li>
<li><p class="first">Click <strong>ACCESS</strong> next to jumpohost.f5lab.local</p>
<p><img alt="image001" src="../../_images/0012.png" /></p>
</li>
<li><p class="first">Select your RDP resolution.</p>
</li>
<li><p class="first">The RDP client on your local host establishes a RDP connection to the Jump Host.</p>
</li>
<li><p class="first">Login with the following credentials:</p>
<blockquote>
<div><ul class="simple">
<li>User: <strong>f5lab\user1</strong></li>
<li>Password: <strong>user1</strong></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">After successful logon the Chrome browser will auto launch opening the site <a class="reference external" href="https://portal.f5lab.local">https://portal.f5lab.local</a>.  This process usually takes 30 seconds after logon.</p>
</li>
<li><p class="first">Click the <strong>Classes</strong> tab at the top of the page.</p>
<blockquote>
<div><p><img alt="image002" src="../../_images/0022.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Scroll down the page until you see <strong>101 Intro to Access Foundational Concepts</strong> on the left</p>
<p><img alt="image003" src="../../_images/0032.png" /></p>
</li>
<li><p class="first">Hover over tile <strong>Visual Policy Editor (VPE) Overview</strong>. A start and stop icon should appear within the tile.  Click the <strong>Play</strong> Button to start the automation to build the environment</p>
<p><img alt="image004" src="../../_images/0042.png" /></p>
</li>
<li><p class="first">The screen should refresh displaying the progress of the automation within 30 seconds.  Scroll to the bottom of the automation workflow to ensure all requests succeeded.  If you experience errors try running the automation a second time or open an issue on the <a class="reference external" href="https://github.com/f5devcentral/access-labs">Access Labs Repo</a>.</p>
<p><img alt="image005" src="../../_images/0052.png" /></p>
</li>
</ol>
</div>
<div class="section" id="section-1-the-access-profile">
<h2>Section 1 - The Access Profile<a class="headerlink" href="#section-1-the-access-profile" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">From a browser navigate to <a class="reference external" href="https://bigip1.f5lab.local">https://bigip1.f5lab.local</a></p>
</li>
<li><p class="first">Login with username <strong>admin</strong> and password <strong>admin</strong></p>
<blockquote>
<div><p><img alt="image006" src="../../_images/0062.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Navigate to Access &gt;&gt; Profiles/Policies &gt;&gt; Access Profiles (Per-Session Policies).</p>
<blockquote>
<div><p><img alt="image007" src="../../_images/0072.png" /></p>
</div></blockquote>
</li>
<li><p class="first">The <strong>Status</strong> flag indicates if there are changed pending to the policy.  When the flag is yellow there are changes pending to the policy.  We will interact with <strong>Pending Changes</strong> later in the lab.</p>
<blockquote>
<div><p><img alt="image008" src="../../_images/0082.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Click <strong>server1-psp</strong></p>
<blockquote>
<div><p><img alt="image009" src="../../_images/0092.png" /></p>
</div></blockquote>
</li>
<li><p class="first">The <strong>Properties</strong> section provides baseline settings related to Scope, timers, and languages across the all sessions that will use the policy regardless of how Visual Policy Editor is configured.</p>
<blockquote>
<div><p><img alt="image010" src="../../_images/0102.png" /></p>
<table border="1" class="docutils align-default">
<colgroup>
<col width="15%" />
<col width="15%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Setting</th>
<th class="head">Value</th>
<th class="head">Description and defaults</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Name</td>
<td>text</td>
<td>Specifies the name of the access profile.</td>
</tr>
<tr class="row-odd"><td>Inactivity Timeout</td>
<td>Number of seconds, or 0</td>
<td>Specifies the inactivity timeout for the connection. If there is no activity between the client and server within
the specified threshold time, the system closes the current session. By default, the threshold is 0, which
specifies that as long as a connection is established, the inactivity timeout is inactive. However, if an
inactivity timeout value is set, when server traffic exceeds the specified threshold, the inactivity timeout is
reset.</td>
</tr>
<tr class="row-even"><td>Access Policy Timeout</td>
<td>Number of seconds, or 0</td>
<td>Designed to keep malicious users from creating a denial-of-service (DoS) attack on your server. The timeout
requires that a user, who has followed through on a redirect, must reach the webtop before the timeout expires.
The default value is 300 seconds.</td>
</tr>
<tr class="row-odd"><td>Maximum Session Timeout</td>
<td>Number of seconds, or 0</td>
<td>The maximum lifetime is from the time a session is created, to when the session terminates. By default, it is set
to 0, which means no limit. When you configure a maximum session timeout setting other than 0, there is no way to
extend the session lifetime, and the user must log out and then log back in to the server when the session expires.</td>
</tr>
<tr class="row-even"><td>Max Concurrent Users</td>
<td>Number of users, or 0</td>
<td>The number of sessions allowed at one time for this access profile. The default value is 0 which specifies
unlimited sessions.</td>
</tr>
<tr class="row-odd"><td>Max Sessions Per User</td>
<td>Number between 1 and
1000, or 0</td>
<td>Specifies the number of sessions for one user that can be active concurrently. The default value is 0, which
specifies unlimited sessions. You can set a limit from 1-1000. Values higher than 1000 cause the access profile
to fail.</td>
</tr>
<tr class="row-even"><td>Max In Progress Sessions
Per Client IP</td>
<td>Number 0 or greater</td>
<td>Specifies the maximum number of sessions that can be in progress for a client IP address. When setting this value,
take into account whether users will come from a NAT-ed or proxied client address and, if so, consider increasing
the value accordingly. The default value is 0 which represents unlimited sessions.</td>
</tr>
<tr class="row-odd"><td>Restrict to Single
Client IP</td>
<td>Selected or cleared</td>
<td>When selected, limits a session to a single IP address.</td>
</tr>
<tr class="row-even"><td>Logout URI Include</td>
<td>One or more URIs</td>
<td>Specifies a list of URIs to include in the access profile to initiate session logout.</td>
</tr>
<tr class="row-odd"><td>Logout URI Timeout</td>
<td>Logout delay URI in
seconds</td>
<td>Specifies the time delay before the logout occurs, using the logout URIs defined in the logout URI include list.</td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
<li><p class="first">Click <strong>SSO/Auth Domains</strong></p>
<blockquote>
<div><p><img alt="image011" src="../../_images/0112.png" /></p>
<table border="1" class="docutils align-default">
<colgroup>
<col width="15%" />
<col width="15%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Setting</th>
<th class="head">Value</th>
<th class="head">Description and defaults</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Domain Mode</td>
<td>Single Domain or
Multiple Domains</td>
<td>Select Single Domain to apply your SSO configuration to a single domain. Select Multiple Domain to apply your SSO
configuration across multiple domains. This is useful in cases where you want to allow your users a single Access
Policy Manager® (APM®) login session and apply it across multiple Local Traffic Manager™ or APM virtual servers,
front-ending different domains.</td>
</tr>
<tr class="row-odd"><td>Domain Cookie</td>
<td>A Domain Cookie</td>
<td>If you specify a domain cookie, then the line domain=specified_domain is added to the MRHsession
cookie.</td>
</tr>
<tr class="row-even"><td>Cookie Options:
Secure</td>
<td>Enable or disable check
box</td>
<td>Enabled, this setting specifies to add the secure keyword to the session cookie. If you are configuring an
application access control scenario where you are using an HTTPS virtual server to authenticate the user, and then
sending the user to an existing HTTP virtual server to use applications, clear this check box.</td>
</tr>
<tr class="row-odd"><td>Cookie Options:
Persistent</td>
<td>Enable or disable check
box</td>
<td>Enabled, this setting specifies to set cookies if the session does not have a webtop. When the session is first
established, session cookies are not marked as persistent, but when the first response is sent to the client after
the access policy completes successfully, the cookies are marked persistent.</td>
</tr>
<tr class="row-even"><td>Cookie Options:
HTTP only</td>
<td>Enable or disable check
box</td>
<td>HttpOnly is an additional flag included in a Set-Cookie HTTP response header. Use the HttpOnly flag when generating
a cookie to help mitigate the risk of a client-side script accessing the protected cookie, if the browser supports
HttpOnly.</td>
</tr>
<tr class="row-odd"><td>SSO Configuration</td>
<td>Predefined SSO
Configuration</td>
<td>SSO configurations contain settings to configure single sign-on with an access profile. Select the SSO
configuration from the list that you want applied to your domain.</td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
<li><p class="first">Click <strong>Multiple Domains</strong>.  Notice additional fields now appear on the screen.</p>
<blockquote>
<div><p><img alt="image012" src="../../_images/0122.png" /></p>
<table border="1" class="docutils align-default">
<colgroup>
<col width="15%" />
<col width="15%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Setting</th>
<th class="head">Value</th>
<th class="head">Description and defaults</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Primary Authentication
URI</td>
<td>URI</td>
<td>The URI of your primary authentication server, for example <a class="reference external" href="https://logon.siterequest.com">https://logon.siterequest.com</a>. This is required if you
use SSO across multiple domains. You provide this URI so your users can access multiple back-end applications from
multiple domains and hosts without requiring them to re-enter their credentials, because the user session is stored
on the primary domain.</td>
</tr>
<tr class="row-odd"><td>Cookie</td>
<td>Domain or Host</td>
<td>If you specify multiple domains, populate this area with hosts or domains. Each host or domain can have a separate
SSO config, and you can set persistent or secure cookies. Click Add to add each host you configure.</td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
<li><p class="first">Click <strong>Access Policy</strong></p>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Object builds outside visual policy editor, but used within the policy are displayed here.</p>
</div>
</div></blockquote>
</li>
<li><p class="first">Click <strong>Edit Access Policy for Profile “server1-psp”</strong> to open Visual Policy Editor(VPE) in a new tab.</p>
<blockquote>
<div><p><img alt="image013" src="../../_images/0132.png" /></p>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="section-2-visual-policy-editor-vpe">
<h2>Section 2 - Visual Policy Editor(VPE)<a class="headerlink" href="#section-2-visual-policy-editor-vpe" title="Permalink to this headline">¶</a></h2>
<p>Visual Policy Editor is used for configuration of Access Policies in APM.  Using an access policy, you can define a sequence of checks to enforce the required level of security on a users system, before the user is granted access to servers, applications, and other resources on your network.</p>
<p>The policy below presents a user with a logon page to collect credentials.  Once the credentials are collected they are validated against Active Directory. If the credentials are valid the connection to the server is allowed, if they are invalid access is denied.</p>
<blockquote>
<div><img alt="image014" src="../../_images/0142.png" /></div></blockquote>
<p>Let’s explore the components that make up Visual Policy Editor workflows.</p>
<div class="section" id="task-2-1-branches">
<h3>Task 2.1 - Branches<a class="headerlink" href="#task-2-1-branches" title="Permalink to this headline">¶</a></h3>
<p>A branch rule evaluates the result of an access policy action, findings about a client system, or other access policy item. The outcome of the evaluation of a branch rule grants or denies access, or continues on to the next action. The order of branch rules in an access policy determines the flow of action.</p>
<p>Some actions such as Logon Pages only have a single default branch, while other actions such as authentication will have a minimum of two branches.</p>
<p>When a creating a policy from scratch there will only be a single branch connecting the <strong>Start</strong> item to the <strong>Deny</strong> Terminal as depicted below.</p>
<ol class="arabic">
<li><p class="first">Click on the <strong>AD Auth</strong> action to explore its configuration.</p>
<blockquote>
<div><p><img alt="image015" src="../../_images/0152.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Actions will have at least two tabs.  One contains the settings for that action, while the second one contains the Branch Rules. Click <strong>Branch Rules</strong>.</p>
<p><img alt="image016" src="../../_images/0161.png" /></p>
</li>
<li><p class="first">The AD Auth action has two branch rules. In order to proceed down the Successful branch <strong>Active Directory Auth has Passed</strong> must be true.  If not the user will proceed down the fallback branch. Click <strong>change</strong> to take a deeper look at the Expression.</p>
<p><img alt="image017" src="../../_images/0171.png" /></p>
</li>
<li><p class="first">Expressions can be modified under the <strong>Simple</strong> or <strong>Advanced</strong> Tabs.  The Simple tab allows you create expression using boolean logic.  If something is added to the AND expression both conditions must be true.  While if something is add the OR condition either condition must be true.  Click <strong>Advanced</strong>.</p>
<blockquote>
<div><p><img alt="image018" src="../../_images/0181.png" /></p>
</div></blockquote>
</li>
<li><p class="first">The <strong>Advanced</strong> tab allows direct modification of the expression using TCL.  You can now see that AD Auth action evaluates the session variable session.ad.last.authresult to determine if the value is a 1(true).</p>
</li>
<li><p class="first">Click <strong>Cancel</strong> because we do not want to modify anything in the AD Auth action.</p>
<p><img alt="image019" src="../../_images/0192.png" /></p>
</li>
</ol>
</div>
<div class="section" id="task-2-2-building-blocks">
<h3>Task 2.2 - Building Blocks<a class="headerlink" href="#task-2-2-building-blocks" title="Permalink to this headline">¶</a></h3>
<p>APM includes a number of pre-defined actions. You can see the available actions in the visual policy editor when you click the Add Item button , which is activated by positioning the cursor along the actions rule branch. The Add Item popup screen opens as a floating popup screen on top of the visual policy editor.</p>
<ol class="arabic">
<li><p class="first">Click the <strong>+ (Plus Symbol)</strong> on the Successful of the AD Auth Action.</p>
<blockquote>
<div><p><img alt="image064" src="../../_images/064.png" /></p>
<p>The Actions selection screen has a default set of six tabs.  Each tab contains a collection of predefined actions related to that tab.</p>
</div></blockquote>
</li>
<li><p class="first">The <strong>Logon</strong> tab contains various ways of collections user credentials.</p>
<blockquote>
<div><p><img alt="image020" src="../../_images/0201.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Click the Authentication Tab.  It contains actions that either validate credentials or interact with directory servers in some way.</p>
<blockquote>
<div><p><img alt="image022" src="../../_images/0221.png" /></p>
<p><img alt="image023" src="../../_images/0231.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Click the <strong>Assignment</strong> tab.  It determines the association between resources and users.  Secondly this is where mechanisms such as ACLs or bandwidth controls are chosen.</p>
<p><img alt="image024" src="../../_images/024.png" /></p>
</li>
<li><p class="first">Click the Endpoint Security (Server-side) tab.  These endpoint checks do not require anything to be installed on the client.</p>
<blockquote>
<div><p><img alt="image025" src="../../_images/025.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Click the Endpoint Security (Client-side) tab.  These endpoints checks require software to be installed on the client.  Either the Edge Client is using VPN or F5 Helper Agent if performing posture via a web browser.  It’s important to know the initial installation requires administrative privileges on the client machine.  In this environment the software is already installed on the jumphost.</p>
<blockquote>
<div><p><img alt="image026" src="../../_images/026.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Click the <strong>General Purpose</strong> tab. We are now going to add a new action to the policy.</p>
</li>
<li><p class="first">Click <strong>Message Box</strong></p>
</li>
<li><p class="first">Click <strong>Add Item</strong></p>
<blockquote>
<div><p><img alt="image027" src="../../_images/027.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Enter the text <strong>Learning APM</strong> in the Title Section.</p>
</li>
<li><p class="first">Click <strong>Save</strong></p>
<blockquote>
<div><p><img alt="image028" src="../../_images/028.png" /></p>
</div></blockquote>
</li>
<li><p class="first">We have successfully added our first new action to this policy.  Now After the user credentials are successfully validated against Active Directory the user will see a message box with the text “Learning APM”.</p>
</li>
<li><p class="first">Also notice a new set of text has appeared in the top left corner of the policy.  When you see <strong>Apply Access Policy</strong> in the left corner it means a policy has changes that have been saved but yet to be committed.  It is important to understand that changes made to a per-session policy do not impact existing sessions. we will leave it that way for now as we have more changes to make.</p>
<p><img alt="image029" src="../../_images/029.png" /></p>
</li>
</ol>
</div>
<div class="section" id="task-2-3-macros">
<h3>Task 2.3 - Macros<a class="headerlink" href="#task-2-3-macros" title="Permalink to this headline">¶</a></h3>
<p>A macro is a collection of actions that you can configure to provide common access policy functions. You can create a macro for any action or series of actions in an access policy. You can also create macros that contain macrocalls to other macros (nested macros).
After you create a macro, you place it in the access policy by adding an item called a macrocall to your policy. A macrocall is an action that performs the functions defined in a macro. In the visual policy editor, a macrocall appears in an access policy, or in a macro definition, as a single rectangular item, surrounded by a double line, with one or more outgoing macro terminal branches, called terminals.</p>
<p>In this task we are going to create a Macro that detects the client operating system.  If the system is Windows it proceed to a Firewall check.  If the system is anything but Windows the client will proceed down the <strong>Fail</strong> branch.</p>
<blockquote>
<div><img alt="image030" src="../../_images/030.png" /></div></blockquote>
<ol class="arabic">
<li><p class="first">Click <strong>Add New Macro</strong>.</p>
<blockquote>
<div><p><img alt="image031" src="../../_images/031.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Enter the name for the macro <strong>Posture Assessments</strong></p>
</li>
<li><p class="first">Click Save</p>
<blockquote>
<div><p><img alt="image032" src="../../_images/032.png" /></p>
</div></blockquote>
</li>
<li><p class="first">The empty Macro name now Appears under the policy and can be edited just like the main Per-session Policy.</p>
</li>
<li><p class="first">Expand the Macro by clicking the plus symbol</p>
<p><img alt="image033" src="../../_images/033.png" /></p>
</li>
<li><p class="first">By default a Macro only has a single terminal.  We know upfront that we intent to have a pass/fail condition so it is best create our additional terminal upfront.</p>
</li>
<li><p class="first">Click <strong>Edit Terminals</strong></p>
<p><img alt="image034" src="../../_images/034.png" /></p>
</li>
<li><p class="first">Click <strong>Add Terminal</strong></p>
<blockquote>
<div><p><img alt="image035" src="../../_images/035.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Change the default terminal text to <strong>Pass</strong>. This is the terminal using the color green</p>
</li>
<li><p class="first">Change the new terminal text to <strong>Fail</strong>.</p>
</li>
<li><p class="first">Toggle the Terminal Endpoints order so the <strong>Fail</strong> Terminal is on the <strong>bottom</strong>.</p>
<blockquote>
<div><p><img alt="image036" src="../../_images/036.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Click <strong>Set Default</strong></p>
</li>
<li><p class="first">Change the default to <strong>Fail</strong></p>
</li>
<li><p class="first">Click <strong>Save</strong></p>
<blockquote>
<div><p><img alt="image037" src="../../_images/037.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Click the <strong>+(Plus Symbol)</strong> inside of the Macro’s fallback branch.</p>
<blockquote>
<div><p><img alt="image038" src="../../_images/038.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Click the <strong>Endpoint Security (Server-Side)</strong> tab</p>
</li>
<li><p class="first">Select <strong>Client OS</strong></p>
</li>
<li><p class="first">Click <strong>Add Item</strong></p>
<blockquote>
<div><p><img alt="image039" src="../../_images/039.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Click <strong>Save</strong></p>
<blockquote>
<div><p><img alt="image040" src="../../_images/040.png" /></p>
</div></blockquote>
</li>
<li><p class="first">We able to only allow Windows hosts to connect.  Click <strong>Pass</strong> on  the Windows RT branch.</p>
<blockquote>
<div><p><img alt="image041" src="../../_images/041.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Select <strong>Fail</strong></p>
</li>
<li><p class="first">Click <strong>Save</strong></p>
<blockquote>
<div><p><img alt="image042" src="../../_images/042.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Click the <strong>Fail</strong> Terminal on the Windows branch.</p>
<blockquote>
<div><p><img alt="image043" src="../../_images/043.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Select <strong>Pass</strong></p>
</li>
<li><p class="first">Click <strong>Save</strong></p>
<blockquote>
<div><p><img alt="image044" src="../../_images/044.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Click the <strong>+(Plus Symbol)</strong> inside of the Windows branch.</p>
<blockquote>
<div><p><img alt="image045" src="../../_images/045.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Click the <strong>Endpoint Security (Client-side)</strong> tab.</p>
</li>
<li><p class="first">Select <strong>Firewall</strong></p>
</li>
<li><p class="first">Click <strong>Add Item</strong></p>
<blockquote>
<div><p><img alt="image046" src="../../_images/046.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Leave the defaults.  Click <strong>Save</strong></p>
<blockquote>
<div><p><img alt="image047" src="../../_images/047.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Now add your completed Macro to the Policy by clicking the <strong>+(Plus Symbol)</strong> between the Start Item and Logon Page action.</p>
<blockquote>
<div><p><img alt="image048" src="../../_images/048.png" /></p>
</div></blockquote>
</li>
<li><p class="first">A new tab has appeared now that a Macro has been configured.  Click the <strong>Macros</strong> tab</p>
</li>
<li><p class="first">Select <strong>Posture Assessments</strong></p>
</li>
<li><p class="first">Click <strong>Add Item</strong></p>
<blockquote>
<div><p><img alt="image049" src="../../_images/049.png" /></p>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="task-2-5-endings">
<h3>Task 2.5: Endings<a class="headerlink" href="#task-2-5-endings" title="Permalink to this headline">¶</a></h3>
<p>Endings allow an administrator to customize APM’s response by introducing redirects rather than generic Allow or Deny action.   We will explore added a redirect to our policy to see it’s behavior during testing.</p>
<ol class="arabic">
<li><p class="first">Click <strong>Edit Endings</strong></p>
<blockquote>
<div><p><img alt="image050" src="../../_images/050.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Click <strong>Add Ending</strong></p>
<blockquote>
<div><p><img alt="image051" src="../../_images/051.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Select the <strong>Redirect</strong> radio button</p>
</li>
<li><p class="first">Enter the URL <strong>https://www.f5.com</strong></p>
</li>
<li><p class="first">Update the color #16 Violet</p>
</li>
<li><p class="first">Enter the Name <strong>Redirect</strong> for the Redirect Terminal</p>
</li>
<li><p class="first">Click <strong>Save</strong></p>
<blockquote>
<div><p><img alt="image052" src="../../_images/052.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Select the <strong>Deny</strong> Terminal off the AD Auth Action fallback branch</p>
<blockquote>
<div><p><img alt="image053" src="../../_images/053.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Select the <strong>Redirect</strong> Terminal</p>
</li>
<li><p class="first">Click <strong>Save</strong></p>
<blockquote>
<div><p><img alt="image054" src="../../_images/054.png" /></p>
</div></blockquote>
</li>
<li><p class="first">We now a have completed Policy.  Click <strong>Apply Access Policy</strong> in the top left.</p>
<p><img alt="image055" src="../../_images/055.png" /></p>
</li>
</ol>
</div>
<div class="section" id="task-2-6-testing">
<h3>Task 2.6 Testing<a class="headerlink" href="#task-2-6-testing" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Open a new browser tab and then navigate to <a class="reference external" href="https://server1.acme.com">https://server1.acme.com</a>.  You will be redirected to /my.policy and the first thing that happens in our policy is the Windows and Firewall Check.  You can see these are being performed as the agent software is being triggered when the screen states <strong>Awaiting Connection…</strong> and then transitions to <strong>Checking for security software</strong>.</p>
<blockquote>
<div><p><img alt="image056" src="../../_images/056.png" /></p>
<p><img alt="image057" src="../../_images/057.png" /></p>
</div></blockquote>
</li>
<li><p class="first">After posture assessment has been successful performed the logon screen will appear.</p>
<blockquote>
<div><p><img alt="image058" src="../../_images/058.png" /></p>
</div></blockquote>
</li>
<li><p class="first">we are going to first test if the redirect works by failing Active Directory Authentication.  Enter the username: test and password:test and attempt to logon.  Repeat this step two more times because the AD auth agent by default requires three failed logon attempts before sending the user down the fallback branch.</p>
<blockquote>
<div><p><img alt="image059" src="../../_images/059.png" /></p>
</div></blockquote>
</li>
<li><p class="first">One authentication has been failed 3 times you are directed to <a class="reference external" href="https://www.f5.com">https://www.f5.com</a> as expected.</p>
<p><img alt="image060" src="../../_images/060.png" /></p>
</li>
<li><p class="first">The session has been closed by the redirect Action.  Navigate back to <a class="reference external" href="https://server1.acme.com">https://server1.acme.com</a></p>
</li>
<li><p class="first">At the logon page enter the Username:<strong>user1</strong> and Password:<strong>user1</strong></p>
</li>
<li><p class="first">Click <strong>Logon</strong></p>
<p><img alt="image061" src="../../_images/061.png" /></p>
</li>
<li><p class="first">After successful authentication you are presented the Message box with the text <strong>learning APM</strong>.  Click <strong>Continue</strong>.</p>
<p><img alt="image062" src="../../_images/062.png" /></p>
</li>
<li><p class="first">User1 has successfully authenticated through the policy and now granted access to their resource.</p>
<blockquote>
<div><p><img alt="image063" src="../../_images/063.png" /></p>
</div></blockquote>
</li>
</ol>
</div>
</div>
<div class="section" id="lab-cleanup">
<h2>Lab Cleanup<a class="headerlink" href="#lab-cleanup" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">From a browser on the jumphost navigate to <a class="reference external" href="https://portal.f5lab.local">https://portal.f5lab.local</a></p>
</li>
<li><p class="first">Click the <strong>Classes</strong> tab at the top of the page.</p>
<blockquote>
<div><p><img alt="image002" src="../../_images/0022.png" /></p>
</div></blockquote>
</li>
<li><p class="first">Scroll down the page until you see <strong>101 Intro to Access Foundational Concepts</strong> on the left</p>
<p><img alt="image003" src="../../_images/0032.png" /></p>
</li>
<li><p class="first">Hover over tile <strong>Visual Policy Editor (VPE) Overview</strong>. A start and stop icon should appear within the tile.  Click the <strong>Stop</strong> Button to trigger the automation to remove any prebuilt objects from the environment</p>
<p><img alt="image998" src="../../_images/998.png" /></p>
</li>
<li><p class="first">The screen should refresh displaying the progress of the automation within 30 seconds.  Scroll to the bottom of the automation workflow to ensure all requests succeeded.  If you experience errors try running the automation a second time or open an issue on the <a class="reference external" href="https://github.com/f5devcentral/access-labs">Access Labs Repo</a>.</p>
<p><img alt="image999" src="../../_images/999.png" /></p>
</li>
<li><p class="first">This concludes the lab.</p>
<p><img alt="image000" src="../../_images/0001.png" /></p>
</li>
</ol>
</div>
</div>


     </div>
    
     <div class="row next-prev-btn-row">
       <div class="col-lg-12">
       
        <a href="lab01.html" title="Lab 1: APM GUI Overview" accesskey="p" class="btn btn-primary left"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous</a>
       
       
          <a href="lab03.html" title="Lab 3: Access Logs Overview" accesskey="n" class="btn btn-primary right">Next <i class="fa fa-arrow-circle-right" aria-hidden="true"></i></a>
       
     </div>
     </div>
    

    </article>
  </div>

</div>


  <div id="clouddocs-footer"></div>
  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->

  <script src="../../_static/js/index.js"></script>
  <script src="../../_static/js/jquery.appear.js"></script>
  <script src="../../_static/js/printThis.js"></script>
  <script src="../../_static/js/bootstrap.min.js"></script>
  <script src="../../_static/js/clouddocs.js"></script>
  <script src="../../_static/js/CoveoJsSearch.Lazy.min.js"></script>
  </body>
</html>